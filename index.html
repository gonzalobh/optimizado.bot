<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tomos Bot</title>

  <!-- Firebase (compat) -->
  
  <!-- Cropper.js -->
<link href="https://cdn.jsdelivr.net/npm/cropperjs@1.6.1/dist/cropper.min.css" rel="stylesheet">


  <!-- UI -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Manrope:wght@400;600&family=Merriweather:wght@400;700&family=Poppins:wght@400;600&family=Playfair+Display:wght@400;700&family=Roboto:wght@400;600&display=swap" rel="stylesheet">
<link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
<link rel="manifest" href="favicon/site.webmanifest">

  <style>
  body {
  font-family: 'Manrope', system-ui, sans-serif !important;
}

body:not(.ready) > *:not(#pageLoader) {
  opacity: 0 !important;
  pointer-events: none !important;
}

    :root{ --tile-radius: 18px; --avatar-radius: 50%; }
    body{ font-family: 'Manrope', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .card{ background:#f3f3f3; border-radius: var(--tile-radius); }
    .toggle{--w:52px;--h:28px;--p:3px;appearance:none;-webkit-appearance:none;outline:none;cursor:pointer;width:var(--w);height:var(--h);border-radius:999px;border:2px solid #111;background:#fff;position:relative;box-sizing:border-box;transition:background .2s,border-color .2s}
    .toggle-sm{--w:32px;--h:20px;--p:3px;}
    .toggle::after{content:"";position:absolute;top:50%;left:var(--p);width:calc(var(--h) - 2*var(--p));height:calc(var(--h) - 2*var(--p));border-radius:50%;background:#111;transform:translateY(-50%);transition:left .2s,background .2s}
    .toggle:checked{background:#111;border-color:#111}
    .toggle:checked::after{background:#fff;left:calc(var(--w) - var(--h) + var(--p))}
    input[type="color"]{-webkit-appearance:none;border:none;width:34px;height:34px;border:1px solid #c9c9c9;border-radius:999px;padding:0;cursor:pointer;overflow:hidden;aspect-ratio:1/1}
    input[type="color"]::-webkit-color-swatch-wrapper{padding:0}
    input[type="color"]::-webkit-color-swatch{border:none;border-radius:999px}
    .color-circle{width:2.5rem;height:2.5rem;border-radius:9999px;padding:0;overflow:hidden;aspect-ratio:1/1}
    .color-circle::-webkit-color-swatch-wrapper{padding:0;border-radius:9999px}
    .color-circle::-webkit-color-swatch{border:none;border-radius:9999px}
    .color-circle::-moz-focus-inner{border:0;padding:0}
    .color-circle::-moz-color-swatch{border-radius:9999px}
    .iphone{ position:relative; width:320px; height:640px; border-radius:34px; background:#000; padding:0px; box-shadow:0 30px 60px rgba(0,0,0,.25); transform:scale(.7); transform-origin:top center;}
    .iphone-in{ width:100%; height:100%; border-radius:26px; overflow:hidden; background:white}
    .notch{ position:absolute;left:50%;top:0;transform:translateX(-50%); width:160px;height:22px;background:#000;border-bottom-left-radius:16px;border-bottom-right-radius:16px}
    .chip{display:inline-flex;align-items:center;gap:8px;border-radius:12px;padding:10px 14px;border:1px solid #e5e7eb;background:#fff;cursor:pointer;font-size:14px}
    .avatar-option{width:56px;height:56px;border-radius:var(--avatar-radius);border:2px solid transparent;background:#f3f4f6;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;position:relative}
    .avatar-option img{width:44px;height:44px;object-fit:cover;border-radius:var(--avatar-radius)}
    .avatar-option:hover{border-color:#93c5fd}
    .avatar-option.active{border-color:#2563eb;background:#eff6ff;box-shadow:0 0 0 4px rgba(37,99,235,.12)}
    .avatar-option.avatar-upload{background:#f9fafb}
    .avatar-option.avatar-upload:hover{background:#f3f4f6}
    #botAvatarImage{border-radius:var(--avatar-radius,50%);}
    .chip.active{border-color:#111;background:#111;color:#fff}
    .chat-panel-tab{flex:1 1 auto;text-align:center; border-bottom: 2px solid #4b546200;padding:0.55rem 0.8rem;border-radius:0px;font-size:14px;font-weight:500;color:#4b5563;display:flex;align-items:center;justify-content:center;gap:0.5rem}
    .chat-panel-tab:hover{color:#111;}
    .chat-panel-tab.active{background: #f3f4f600; border-bottom: 2px solid; border-radius: 0px;}
    .activity-score-active{background:#111 !important;color:#fff !important;border-color:#111 !important}
    .sidebar-btn{display:flex;gap:10px;align-items:center;width:100%;padding:.65rem .8rem;border-radius:12px}
    .sidebar-btn.active{background:#111;color:#fff}
    textarea{resize:none;overflow:hidden;min-height:400px;}
    .widget-mockup{width:72px;height:72px;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 18px rgba(0,0,0,.12);transition:all .2s ease;border-radius:20px;background:#111}
    .widget-mockup .widget-icon-inline svg{filter:drop-shadow(0 2px 4px rgba(0,0,0,.25));}
    .widget-icon-trigger{width:60px;height:60px;border-radius:14px;border:1px solid #e5e7eb;display:flex;align-items:center;justify-content:center;background:#fff;transition:all .2s ease;box-shadow:0 4px 12px rgba(15,23,42,.08)}
    .widget-icon-trigger:hover{border-color:#2563eb;box-shadow:0 8px 18px rgba(37,99,235,.18)}
    .widget-icon-trigger .widget-icon-inline{width:36px;height:36px}
    .widget-icon-trigger svg{width:100%;height:100%}
    #botAvatarButton{width:80px;height:80px;display:flex;align-items:center;justify-content:center}
    #botAvatarButton img{width:56px;height:56px}
    .widget-icon-option{border:2px solid transparent;border-radius:16px;padding:16px;background:#f9fafb;display:flex;align-items:center;justify-content:center;transition:all .2s ease}
    .widget-icon-option .widget-icon-inline{width:44px;height:44px}
    .widget-icon-option svg{width:100%;height:100%}
    .widget-icon-inline{display:flex;align-items:center;justify-content:center}
    .widget-icon-option:hover{border-color:#93c5fd;background:#eff6ff}
    .widget-icon-option.active{border-color:#2563eb;background:#eff6ff;box-shadow:0 0 0 4px rgba(37,99,235,.12)}
    .chat-columns{align-items:stretch;}
    .chat-columns > .chat-column{height:640px;}
    .chat-column-secondary{background:#fff;border-radius:26px;padding:24px;box-shadow:0 10px 24px rgba(15,23,42,.08);border:1px solid rgba(15,23,42,.08);}
    .appearance-chip{min-width:94px;justify-content:center;font-weight:500}
    .personality-option{display:flex;align-items:center;gap:12px;width:100%;padding:10px 14px;border-radius:12px;background:transparent;color:#374151;font-size:14px;font-weight:500;transition:all .2s ease;text-align:left}
    .personality-option:hover{background:#f3f4f6;color:#111}
    .personality-option-icon{display:flex;align-items:center;justify-content:center;width:32px;height:32px;border-radius:999px;background:#f3f4f6;color:#4b5563;flex-shrink:0}
    .personality-option-label{flex:1;display:flex;align-items:center}
    .personality-option-check{opacity:0;transition:opacity .2s ease;color:#10b981}
    .personality-option-active{background:#eef2ff;color:#111;font-weight:600}
    .personality-option-active .personality-option-icon{background:#e0e7ff;color:#1f2937}
    .personality-option-active .personality-option-check{opacity:1}
    .personality-dropdown-button{width:100%;border:1px solid #e5e7eb;border-radius:12px;padding:10px 14px;background:#fff;display:flex;align-items:center;justify-content:space-between;gap:12px;box-shadow:0 8px 18px rgba(15,23,42,.04);transition:all .2s ease;color:#1f2937}
    .personality-dropdown-button:hover{border-color:#d1d5db;box-shadow:0 10px 24px rgba(15,23,42,.08)}
    .personality-dropdown-button:focus{outline:none;box-shadow:0 0 0 3px rgba(17,17,17,.08)}
    .personality-dropdown-label{display:flex;align-items:center;gap:12px;flex:1;min-width:0}
    .personality-dropdown-menu{position:absolute;left:0;right:0;margin-top:8px;padding:8px;border-radius:14px;border:1px solid #e5e7eb;background:#fff;box-shadow:0 18px 38px rgba(15,23,42,.12);z-index:40;display:flex;flex-direction:column;gap:4px}
aside {
  scrollbar-width: thin;
  scrollbar-color: #ccc transparent;
}
aside::-webkit-scrollbar {
  width: 6px;
}
aside::-webkit-scrollbar-thumb {
  background: #bbb;
  border-radius: 10px;
}

#fontFamily option {
  font-size: 14px;
  padding: 6px 8px;
}

#fontFamily option[value="Manrope"] { font-family: 'Manrope', system-ui, sans-serif; }
#fontFamily option[value="Inter"] { font-family: 'Inter', system-ui, sans-serif; }
#fontFamily option[value="Poppins"] { font-family: 'Poppins', system-ui, sans-serif; }
#fontFamily option[value="Roboto"] { font-family: 'Roboto', system-ui, sans-serif; }
#fontFamily option[value="Playfair Display"] { font-family: 'Playfair Display', serif; }
#fontFamily option[value="Merriweather"] { font-family: 'Merriweather', serif; }

#botSelect,
#botSelect option {
  background-color: #fff !important;
  color: #000 !important;
}

#messagesBotFilter:disabled {
  background-color: #f9fafb;
  color: #111;
  cursor: default;
  opacity: 1;
}

#messagesBotFilter,
label[for="messagesBotFilter"] {
  display: none;
}

button.bg-black {
    background: #111;
    color: white !important;
    border: none !important;
    border-radius: 400px !important;
    transition: all 0.2s 
ease;
    font-weight: 400;
}

button.bg-black:hover {
    background: #111111b8;
    color: white !important;
}

/* === Sidebar buttons === */
.sidebar-btn {
  color: #777 !important; /* gris suave para las no activas */
  transition: all 0.2s ease;
}

.sidebar-btn i {
  color: #777 !important;
  transition: color 0.2s ease;
}

/* Activa */
.sidebar-btn.active {
  background: none !important;
  color: #000 !important; /* texto negro */
  font-weight: 500;
}

.sidebar-btn.active i {
  color: #000 !important; /* ícono negro */
}

/* Hover */
.sidebar-btn:hover {
  background: #f5f5f5 !important;
  color: #111 !important;
}

.sidebar-btn:hover i {
  color: #111 !important;
}

/* === Botón Cerrar Sesión (mismo estilo que Save) === */
#btnLogout {
  background: linear-gradient(to bottom, #f7f7f7, #eaeaea) !important;
  color: #111 !important;
  border: none !important;
  border-radius: 12px !important;
  box-shadow: 0 2px 4px rgba(0,0,0,0.06);
  transition: all 0.2s ease;
  font-weight: 400;
}

#btnLogout:hover {
  background: linear-gradient(to bottom, #ececec, #dddddd) !important;
  box-shadow: 0 3px 6px rgba(0,0,0,0.1);
}

.dashboard2-card {
  background:#f3f3f3;
  border-radius: 18px;
  padding: 1.25rem 1.4rem;
  display: flex;
  flex-direction: column;
  gap: 1.25rem;
  justify-content: space-between;
}

.dashboard2-card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.dashboard2-card-title-group {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.dashboard2-card-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 42px;
  height: 42px;
  border-radius: 12px;
  background: #e4e4e4;
  color: #4d4d4d;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.65);
}

.dashboard2-card-title {
  font-size: 0.95rem;
  font-weight: 600;
  color: #3f3f3f;
}

.dashboard2-card-subtitle {
  font-size: 0.8rem;
  font-weight: 500;
  color: #6a6a6a;
  margin-top: 0.1rem;
}

.dashboard2-card-value {
  font-size: 2rem;
  font-weight: 700;
  color: #303030;
}

.dashboard2-chart {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem 0;
  height: 160px;
}

.dashboard2-chart canvas {
  width: 100% !important;
  height: 100% !important;
  max-width: 130px;
  max-height: 130px;
  aspect-ratio: 1/1;
}

.dashboard2-chart-value {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 1rem;
  font-weight: 600;
  color: #333;
}

.dashboard2-panel {
  background: linear-gradient(180deg, #f7f7f7 0%, #f2f2f2 100%);
  border-radius: 18px;
  padding: 1.5rem 1.75rem;
}

.dashboard2-panel-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.dashboard2-panel-subtitle {
  font-size: 0.75rem;
  font-weight: 500;
  color: #6a6a6a;
  letter-spacing: 0.04em;
  text-transform: uppercase;
}

.dashboard2-line-chart {
  margin-top: 1rem;
  height: 210px;
}

.dashboard2-line-chart canvas {
  width: 100% !important;
  height: 100% !important;
}

#embedScriptBox {
  resize: none;
  overflow: hidden;
  min-height: 120px;  /* altura mínima más cómoda para leer el script */
  height: auto;
  line-height: 1.4;
}

/* === Corrección: botones de días seleccionados === */
.day.bg-black {
  background: #000 !important;   /* fondo negro sólido */
  color: #fff !important;        /* texto blanco */
  border: none !important;       /* sin borde */
  box-shadow: none !important;   /* sin sombra */
}
.day.bg-black:hover {
  background: #000 !important;   /* mantiene negro al pasar el mouse */
  color: #fff !important;
}

/* === Modal: Nuevo bot === */
#newBotModal {
  transition: opacity 0.2s ease;
}

#newBotModal.hidden {
  opacity: 0;
  pointer-events: none;
}

#newBotModal .modal-panel {
  background: radial-gradient(circle at top right, rgba(226, 232, 240, 0.28), transparent 45%),
    linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  border-radius: 22px;
  border: 1px solid rgba(148, 163, 184, 0.18);
  box-shadow: 0 35px 60px -25px rgba(15, 23, 42, 0.28);
  position: relative;
  overflow: hidden;
}

#newBotModal .modal-accent {
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at top left, rgba(37, 99, 235, 0.08), transparent 40%),
    radial-gradient(circle at bottom right, rgba(15, 23, 42, 0.08), transparent 55%);
  pointer-events: none;
  opacity: 0.9;
}

#newBotModal .modal-header {
  position: relative;
  z-index: 1;
}

#newBotModal .modal-icon {
  width: 46px;
  height: 46px;
  border-radius: 16px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  background: #232323;
  color: #f8fafc;
  box-shadow: 0 12px 30px rgba(15, 23, 42, 0.25);
}

#newBotModal h3 {
  font-size: 1.1rem;
  font-weight: 600;
  color: #0f172a;
}

#newBotModal p {
  color: #64748b;
}

#newBotModal .modal-input {
  border-radius: 14px;
  border: 1px solid rgba(148, 163, 184, 0.35);
  background: rgba(255, 255, 255, 0.85);
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

#newBotModal .modal-input:focus {
  border-color: rgba(17, 24, 39, 0.6);
  box-shadow: 0 0 0 4px rgba(17, 24, 39, 0.12);
}

#newBotModal .modal-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
  padding: 0.4rem 0.65rem;
  border-radius: 999px;
  background: rgba(15, 23, 42, 0.06);
  color: #0f172a;
  font-size: 0.75rem;
  font-weight: 600;
  letter-spacing: 0.02em;
}

#newBotModal .modal-preview {
  border-radius: 14px;
  border: 1px dashed rgba(148, 163, 184, 0.5);
  background: rgba(248, 250, 252, 0.9);
  color: #1f2937;
  font-size: 0.85rem;
}

#newBotModal .modal-preview span {
  font-family: 'Inter', system-ui, sans-serif;
  letter-spacing: 0.01em;
}

/* === Modal: Auto response type === */
#autoResponseTypeModal {
  transition: opacity 0.25s ease;
}

#autoResponseTypeModal.hidden {
  opacity: 0;
  pointer-events: none;
}

#autoResponseTypeModal .type-modal-panel {
  background: radial-gradient(circle at top right, rgba(226, 232, 240, 0.25), transparent 40%),
    linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  border-radius: 22px;
  border: 1px solid rgba(148, 163, 184, 0.18);
  box-shadow: 0 35px 60px -25px rgba(15, 23, 42, 0.28);
  position: relative;
  overflow: hidden;
  transform: translateY(12px) scale(0.98);
  opacity: 0;
  transition: opacity 0.28s ease, transform 0.28s ease;
}

#autoResponseTypeModal.show .type-modal-panel {
  transform: translateY(0) scale(1);
  opacity: 1;
}

#autoResponseTypeModal .type-modal-accent {
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at top left, rgba(37, 99, 235, 0.08), transparent 38%),
    radial-gradient(circle at bottom right, rgba(16, 185, 129, 0.08), transparent 52%);
  pointer-events: none;
  opacity: 0.9;
}

#autoResponseTypeModal .type-modal-header {
  position: relative;
  z-index: 1;
}

#autoResponseTypeModal .type-option-card {
  border-radius: 16px;
  border: 1px solid rgba(148, 163, 184, 0.35);
  background: rgba(255, 255, 255, 0.85);
  box-shadow: 0 15px 30px -18px rgba(15, 23, 42, 0.32);
  transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease, background 0.2s ease;
}

#autoResponseTypeModal .type-option-card:hover {
  border-color: rgba(17, 24, 39, 0.25);
  transform: translateY(-2px);
  box-shadow: 0 18px 40px -22px rgba(15, 23, 42, 0.4);
}

#autoResponseTypeModal .type-option-card.active {
  border-color: #111827;
  background: #0f172a;
  color: #fff;
  box-shadow: 0 18px 42px -20px rgba(15, 23, 42, 0.6);
}

#autoResponseTypeModal .type-option-card.active .type-option-description {
  color: rgba(255, 255, 255, 0.85);
}

#autoResponseTypeModal .type-option-icon {
  width: 80px;
  height: 80px;
  border-radius: 22px; /* opcional, para mantener proporción */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  color: #111827;
}

#autoResponseTypeModal .type-option-card.active .type-option-icon {
  background: rgba(255, 255, 255, 0.14);
  color: #f8fafc;
  box-shadow: none;
}

#autoResponseTypeModal .type-option-description {
  color: #6b7280;
}

#autoResponseTypeModal .type-modal-actions button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

#autoResponseTypeModal .type-modal-actions .modal-secondary {
  border-radius: 12px;
  border: 1px solid rgba(148, 163, 184, 0.5);
  background: #fff;
  color: #111827;
  box-shadow: 0 10px 20px -14px rgba(15, 23, 42, 0.3);
}

#autoResponseTypeModal .type-modal-actions .modal-secondary:hover {
  border-color: rgba(17, 24, 39, 0.5);
}

#autoResponseTypeModal .type-modal-actions .modal-primary {
  border-radius: 12px;
  background: #111827;
  color: #fff;
  box-shadow: 0 14px 30px -16px rgba(17, 24, 39, 0.6);
}

#autoResponseTypeModal .type-modal-actions .modal-primary:hover {
  box-shadow: 0 16px 34px -18px rgba(17, 24, 39, 0.7);
}

#newBotModal .modal-options {
  display: grid;
  gap: 0.75rem;
  position: relative;
  z-index: 1;
}

#newBotModal .modal-option-card {
  position: relative;
  border-radius: 16px;
  border: 1px solid rgba(148, 163, 184, 0.45);
  background: linear-gradient(145deg, rgba(255, 255, 255, 0.96), rgba(248, 250, 252, 0.88));
  box-shadow: 0 14px 28px -18px rgba(15, 23, 42, 0.25);
  padding: 1rem 1.1rem;
  display: flex;
  align-items: center;
  gap: 0.85rem;
  cursor: pointer;
  transition: border-color 0.18s ease, box-shadow 0.18s ease, transform 0.18s ease;
}

#newBotModal .modal-option-card:hover {
  border-color: rgba(15, 23, 42, 0.35);
  box-shadow: 0 18px 34px -20px rgba(15, 23, 42, 0.28);
}

#newBotModal .modal-option-card.active {
  border-color: rgba(17, 24, 39, 0.75);
  box-shadow: 0 20px 38px -18px rgba(17, 24, 39, 0.32);
  background: #232323;
  transform: translateY(-2px);
}

#newBotModal .modal-option-card.active .modal-option-title,
#newBotModal .modal-option-card.active .modal-option-description {
  color: rgba(248, 250, 252, 0.95);
}

#newBotModal .modal-option-icon {
  flex-shrink: 0;
  width: 42px;
  height: 42px;
  border-radius: 14px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  background: #232323;
  color: rgba(248, 250, 252, 0.95);
  box-shadow: 0 10px 24px rgba(30, 64, 175, 0.25);
}

#newBotModal .modal-option-card.active .modal-option-icon {
  background: linear-gradient(145deg, rgba(248, 250, 252, 0.95), rgba(226, 232, 240, 0.95));
  color: #111827;
  box-shadow: 0 12px 28px rgba(248, 250, 252, 0.25);
}

#newBotModal .modal-option-content {
  display: flex;
  flex-direction: column;
  gap: 0.3rem;
}

#newBotModal .modal-option-title {
  font-size: 0.95rem;
  font-weight: 600;
  color: #0f172a;
}

#newBotModal .modal-option-description {
  font-size: 0.8rem;
  color: #64748b;
}

#newBotModal .modal-option-radio {
  position: absolute;
  opacity: 0;
  pointer-events: none;
}

#newBotModal .modal-actions button {
  border-radius: 12px;
  font-weight: 500;
  transition: transform 0.18s ease, box-shadow 0.18s ease;
}

#newBotModal .modal-actions button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

#newBotModal .modal-actions button:active {
  transform: translateY(1px);
}

#newBotModal .modal-actions .modal-secondary {
  border: 1px solid rgba(148, 163, 184, 0.5);
  color: #0f172a;
  background: rgba(255, 255, 255, 0.95);
}

#newBotModal .modal-actions .modal-secondary:hover {
  background: rgba(226, 232, 240, 0.5);
}

#newBotModal .modal-actions .modal-primary {
  background: #232323;
  color: #f8fafc;
  box-shadow: 0 12px 22px rgba(15, 23, 42, 0.18);
}

#newBotModal .modal-actions .modal-primary:hover {
  box-shadow: 0 16px 28px rgba(15, 23, 42, 0.2);
}

#newBotModal .modal-error {
  color: #dc2626;
  font-size: 0.85rem;
}

#newBotModal .modal-footer-note {
  font-size: 0.75rem;
  color: #94a3b8;
}

#newBotModal .modal-gradient-bar {
  position: absolute;
  inset-inline: 0;
  bottom: 0;
  height: 3px;
  background: linear-gradient(90deg, rgba(79, 70, 229, 0.65), rgba(37, 99, 235, 0.65), rgba(15, 118, 110, 0.6));
}

/* === Templates === */
#toggleTemplatePanel {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: #ffffff;
  border: 1px solid #d1d5db;
  border-radius: 999px;
  padding: 6px 14px;
  font-size: 13px;
  font-weight: 500;
  color: #1f2937;
  box-shadow: 0 6px 16px rgba(15, 23, 42, 0.08);
  transition: all 0.2s ease;
  position: relative;
  overflow: hidden;
}

#toggleTemplatePanel::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(15, 23, 42, 0.06), rgba(15, 23, 42, 0.01));
  opacity: 0;
  transition: opacity 0.2s ease;
}

#toggleTemplatePanel > * {
  position: relative;
  z-index: 1;
}

#toggleTemplatePanel i {
  color: inherit;
}

#toggleTemplatePanel:hover {
  color: #111827;
  border-color: #9ca3af;
  box-shadow: 0 10px 24px rgba(15, 23, 42, 0.12);
  transform: translateY(-1px);
}

#toggleTemplatePanel:hover::after,
#toggleTemplatePanel:focus-visible::after {
  opacity: 1;
}

#toggleTemplatePanel:focus-visible {
  outline: 2px solid #111827;
  outline-offset: 3px;
}

.template-card {
  border-radius: 24px;
  padding: 16px;
  background: #f3f6fb;
  display: flex;
  flex-direction: column;
  gap: 12px;
  transition: all 0.2s ease;
  align-items: stretch;
}

.template-card:hover {
  transform: translateY(-1px);
  box-shadow: 0 10px 24px rgba(15, 23, 42, 0.08);
}

.template-card.active {
 border: 1px solid #747474;
}

.template-card .template-header {
  border-radius: 18px;
  padding: 14px 16px;
  font-size: 13px;
  font-weight: 600;
  text-align: center;
  color: inherit;
}

.template-card .template-preview {
  border-radius: 20px;
  padding: 22px 18px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  background: #e9eef7;
  align-items: center;
}

.template-card .template-assistant,
.template-card .template-client {
  border-radius: 999px;
  padding: 10px 26px;
  font-size: 14px;
  font-weight: 600;
  text-align: center;
  box-shadow: 0 8px 20px rgba(15, 23, 42, 0.08);
}

.template-card .template-assistant {
  background: #ffffff;
}

.template-card .template-client {
  background: #2563eb;
  color: #ffffff;
}

.template-toggle-active {
  background: #111 !important;
  color: #fff !important;
  border-color: #111 !important;
  box-shadow: 0 8px 18px rgba(15, 23, 42, 0.18) !important;
}

#toggleTemplatePanel.template-toggle-active::after {
  opacity: 0;
}

/* === Centrar todas las pestañas excepto Appearance === */
#tab-knowledge,
#tab-respuestas,
#tab-prompt {
  margin-left: auto;
  margin-right: auto;
  width: 100%;
  max-width: 800px; /* puedes ajustar a 900 o 1000 si quieres más ancho */
}
#logoRadiusVal {
  display: inline-block;
  min-width: 2ch; /* reserva espacio suficiente para dos caracteres */
  text-align: right;
}
body.login-view {
  background-color: #f3f4f6;
}

body.login-view main {
  align-items: center;
    margin-left: 0 !important;
  transition: none !important;
}

body.login-view #appContainer {
  padding-top: 3rem;
}

#login {
  width: 100%;
}

@media (max-width: 768px) {
  #appContainer {
    padding-left: 1.25rem;
    padding-right: 1.25rem;
  }
}

@media (max-width: 640px) {
  #login {
    margin-top: 2.5rem;
    padding: 1.75rem;
  }

  #login img {
    width: 88px;
  }

  #login input {
    font-size: 16px;
  }
}

@media (max-width: 1023px) {
  .chat-columns > .chat-column {
    height: auto;
  }
  .iphone {
    max-width: 100%;
    margin-inline: auto;
    transform: scale(.9);
  }
}

@media (max-width: 767px) {
  .iphone {
    transform: scale(.85);
  }
}
/* === Knowledge page buttons === */
.page-btn {
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 10px;
  min-width: 110px;
  min-height: 86px;
  background: #ffffff;
  color: #6b7280;
  border: 1px solid #e5e7eb;
  border-radius: 16px;
  padding: 14px 20px;
  font-size: 13px;
  font-weight: 500;
  text-align: center;
  box-shadow: 0 4px 12px rgba(15, 23, 42, 0.05);
  transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease,
    color 0.15s ease;
}

.page-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 10px 25px rgba(15, 23, 42, 0.12);
  border-color: #d1d5db;
}

.page-btn:focus-visible {
  outline: 2px solid #111;
  outline-offset: 2px;
}

.page-btn .page-btn-icon {
  width: 24px;
  height: 24px;
  color: currentColor;
  stroke-width: 1.8;
}

.page-btn .page-btn-label {
  color: inherit;
  font-size: 14px;
}

.page-btn.active {
  border-color: #111111;
  color: #111111;
  box-shadow: 0 12px 30px rgba(17, 17, 17, 0.15);
}

#saveContext {
  background-color: #000000;
  color: #ffffff;
}

#saveContext:hover {
  background-color: #111111;
}

.dashboard-bots-list {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.dashboard-bot-card {
  position: relative;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  padding: 1.75rem;
  padding-bottom: 3.75rem;
  padding-right: 3.25rem;
  border-radius: 24px;
  background: #f3f3f3;

}

.dashboard-bot-card.loading {
  align-items: center;
  justify-content: center;
  min-height: 140px;
}

.dashboard-bot-card-empty {
  font-size: 0.95rem;
  color: #9ca3af;
}

@media (min-width: 1024px) {
  .dashboard-bot-card {
    flex-direction: row;
    align-items: center;
  }
}

.dashboard-bot-card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1.25rem;
  width: 100%;
}

.dashboard-bot-identity {
  display: flex;
  align-items: center;
  gap: 1rem;
  min-width: 0;
}

.dashboard-bot-icon {
  width: 52px;
  height: 52px;
  border-radius: 16px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  background: #f3f3f300;
  color: #1f2937;
  flex-shrink: 0;
}

.dashboard-bot-icon i {
  width: 22px;
  height: 22px;
}

.dashboard-bot-titles {
  display: flex;
  flex-direction: column;
  gap: 0.2rem;
  min-width: 0;
}

.dashboard-bot-title {
  font-size: 1.05rem;
  font-weight: 600;
  color: #111827;
  line-height: 1.2;
}

.dashboard-bot-subtitle {
  font-size: 0.72rem;
  letter-spacing: 0.16em;
  text-transform: uppercase;
  color: #6b7280;
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.dashboard-bot-card-actions {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex-shrink: 0;
}

.dashboard-bot-delete-btn {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    width: 25px;
    height: 25px;
    border-radius: 14px;
    border: 1px solid rgba(17, 24, 39, 0.1);
    color: #d8d8d8;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  transition: transform 0.2s ease, box-shadow 0.2s ease, color 0.2s ease, background 0.2s ease;
}

.dashboard-bot-delete-btn:hover {
  color: #ef4444;
  background: #fee2e2;
  box-shadow: 0 10px 18px rgba(239, 68, 68, 0.15);
  transform: translateY(-2px);
}

.dashboard-bot-delete-btn i {
  width: 18px;
  height: 18px;
}
/* Puedes borrar la regla anterior del "i" */
.dashboard-bot-delete-btn svg {
  width: 16px !important;
  height: 16px !important;
}


.dashboard-bot-edit-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.4rem;
  padding: 0.55rem 0.95rem;
  border-radius: 14px;
    background: #f3f3f3;  border: 1px solid rgba(17, 24, 39, 0.08);
  font-size: 0.85rem;
  font-weight: 600;
  color: #1f2937;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.dashboard-bot-edit-btn:hover {
        background: #d8d8d857;
}

.dashboard-bot-edit-btn i {
  width: 16px;
  height: 16px;
}

.dashboard-bot-card-body {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  width: 150%;
}

@media (min-width: 1024px) {
  .dashboard-bot-card-body {
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
  }
}

.dashboard-bot-stat {
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
}

.dashboard-bot-stat-label {
  font-size: 0.72rem;
  text-transform: uppercase;
  letter-spacing: 0.16em;
  color: #6b7280;
  font-weight: 600;
}

.dashboard-bot-stat-value {
  font-size: 1.65rem;
  font-weight: 700;
  color: #111827;
}

.dashboard-bot-card-charts {
  display: flex;
  flex-wrap: wrap;
  gap: 2.5rem;
}

.dashboard-bot-chart-block {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.45rem;
  min-width: 110px;
}

.dashboard-bot-chart {
  position: relative;
  width: 96px;
  height: 96px;
}

@media (min-width: 1280px) {
  .dashboard-bot-chart {
    width: 108px;
    height: 108px;
  }
}

.dashboard-bot-chart canvas {
  width: 100% !important;
  height: 100% !important;
}

.dashboard-bot-chart-value {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-weight: 700;
  color: #1f2937;
  font-size: 1rem;
}

.dashboard-bot-chart-label {
  font-size: 0.72rem;
  text-transform: uppercase;
  letter-spacing: 0.14em;
  color: #6b7280;
  font-weight: 600;
  text-align: center;
}

.dashboard-bot-chart-text {
  font-size: 0.85rem;
  font-weight: 600;
  color: #111827;
  text-align: center;
}


  header .fixed-logo {
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    height: 38px;
    width: auto;
    border-radius: 10px;
    object-fit: contain;
    z-index: 50;
  }

td .acciones {
  display: flex;
  align-items: center;
  justify-content: center; /* o space-between si quieres separarlos */
  gap: 10px; /* ajusta la separación entre íconos */
}

#autoResponseTypeModalPanel {
  margin-left: auto;
  margin-right: auto;
}

#testBotButton {
  margin-left: 0;
  transform: none;
  position: relative;
  z-index: 20;
  height: 36px;
}

#headerControls {
  gap: 8px;
}

#languageSelect {
  min-width: 96px;
  height: 36px;
  padding-left: 8px;
  padding-right: 8px;
}


    </style>
</head>
<body class="min-h-screen overflow-x-hidden" style=" background: #ffffff; ">
  <!-- Loader -->
  <div id="pageLoader" class="fixed inset-0 bg-white/95 flex flex-col items-center justify-center z-[9999]">
    <div class="animate-spin rounded-full h-14 w-14 border-[3px] border-gray-300 border-t-gray-900"></div>
    <p id="pageLoaderText" class="mt-4 text-gray-600 text-sm">Loading…</p>
  </div>

  <!-- Header minimal -->
<header class="fixed top-0 left-0 w-full bg-white backdrop-blur border-b z-50 shadow-sm">
  <img src="logo.svg" alt="Tomos Logo" class="fixed-logo" />
  <div class="max-w-7xl mx-auto px-5 py-3 relative flex items-center gap-3 w-full">
    <div class="flex items-center gap-2 shrink-0">
      <button id="toggleSidebarBtn" class="md:hidden lg:hidden p-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-100">
        <i data-lucide="menu" class="w-5 h-5"></i>
      </button>
    </div>
    <div class="absolute left-1/2 -translate-x-1/2 flex items-center gap-2 px-1 sm:px-2 z-10" id="botSelectorWrap">
        <select id="botSelect" class="border border-gray-200 rounded-md px-2 py-1 text-xs leading-tight bg-white focus:outline-none focus:ring-1 focus:ring-black/40 min-w-[120px] h-8">
          <option value="" disabled selected>Loading bots…</option>
        </select>
        <button
          id="btnNewBot"
          class="inline-flex items-center justify-center w-9 h-9 text-lg font-semibold text-white bg-black rounded-full hover:bg-black/80 transition"
          aria-label="Crear nuevo bot"
        >
          +
        </button>
      </div>
    <div class="flex items-center gap-2 sm:gap-3 ml-auto flex-wrap justify-end" id="headerControls">
      <button
        id="testBotButton"
        class="inline-flex items-center gap-2 px-3 h-9 text-sm text-gray-700 border border-gray-200 rounded-lg bg-white hover:bg-gray-100 transition shadow-sm shrink-0"
        type="button"
      >
        <i data-lucide="bot" class="w-4 h-4"></i>
        <span>Probar Bot</span>
      </button>
      <select id="languageSelect" class="border border-gray-200 rounded-md px-2 py-1 text-xs leading-tight bg-white focus:outline-none focus:ring-1 focus:ring-black/40 notranslate h-9 min-w-[96px]">
        <option value="en">EN</option>
        <option value="fr">FR</option>
        <option value="es">ES</option>
        <option value="de">DE</option>
        <option value="pt">PT</option>
      </select>
          <div class="flex flex-col items-end text-right leading-tight shrink-0">
        <span id="empresaBadge" class="text-[8px] bg-black text-white px-1 py-[1px] rounded mb-[2px]">—</span>
        <span id="authEmail" class="text-xs text-gray-500 break-words max-w-[200px] md:max-w-[240px]">—</span>
      </div>
      <button id="btnLogout" class="px-3 py-1.5 bg-red-600 text-white rounded-md hidden shrink-0 flex items-center justify-center" aria-label="Cerrar sesión">
        <span class="sr-only">Cerrar sesión</span>
        <i data-lucide="log-out" class="w-4 h-4"></i>
      </button>
    </div>
  </div>
</header>


<div id="headerSpacer" class="h-[57px]"></div>
<div class="flex min-h-screen w-full relative">
      <!-- Sidebar -->
<aside id="sidebar" class="hidden md:hidden peer group flex flex-col fixed top-[57px] left-0 h-[calc(100vh-57px)] bg-white border-r overflow-y-auto transition-transform duration-300 -translate-x-full md:translate-x-0 w-56 md:w-[72px] lg:w-[72px] lg:hover:w-[260px] shadow-lg md:shadow-none z-50 md:z-auto">
  <nav class="space-y-2 mt-4 px-2">
    <button class="sidebar-btn active flex items-center gap-3 w-full p-3 rounded-lg transition-colors hover:bg-gray-100" data-tab="dashboard">
      <i data-lucide="layout-dashboard" class="w-5 h-5 shrink-0"></i>
      <span class="hidden lg:inline lg:opacity-0 lg:group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap">Dashboard</span>
    </button>
    <button class="sidebar-btn flex items-center gap-3 w-full p-3 rounded-lg transition-colors hover:bg-gray-100 hidden" data-tab="dashboard2" id="dashboard2TabBtn">
      <i data-lucide="bar-chart-3" class="w-5 h-5 shrink-0"></i>
      <span class="hidden lg:inline lg:opacity-0 lg:group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap">Dashboard</span>
    </button>
    <button class="sidebar-btn flex items-center gap-3 w-full p-3 rounded-lg transition-colors hover:bg-gray-100" data-tab="chat">
      <i data-lucide="message-circle" class="w-5 h-5 shrink-0"></i>
      <span class="hidden lg:inline lg:opacity-0 lg:group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap">Chat</span>
    </button>
    <button class="sidebar-btn flex items-center gap-3 w-full p-3 rounded-lg transition-colors hover:bg-gray-100" data-tab="mensajes">
      <i data-lucide="inbox" class="w-5 h-5 shrink-0"></i>
      <span class="hidden lg:inline lg:opacity-0 lg:group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap">Mensajes</span>
    </button>
    <button class="sidebar-btn flex items-center gap-3 w-full p-3 rounded-lg transition-colors hover:bg-gray-100" data-tab="knowledge">
      <i data-lucide="book-open" class="w-5 h-5 shrink-0"></i>
      <span class="hidden lg:inline lg:opacity-0 lg:group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap">Knowledge</span>
    </button>
    <button class="sidebar-btn flex items-center gap-3 w-full p-3 rounded-lg transition-colors hover:bg-gray-100" data-tab="respuestas">
      <i data-lucide="messages-square" class="w-5 h-5 shrink-0"></i>
      <span class="hidden lg:inline lg:opacity-0 lg:group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap">Auto Responses</span>
    </button>
    <button class="sidebar-btn flex items-center gap-3 w-full p-3 rounded-lg transition-colors hover:bg-gray-100" data-tab="prompt">
      <i data-lucide="file-text" class="w-5 h-5 shrink-0"></i>
      <span class="hidden lg:inline lg:opacity-0 lg:group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap">Prompt</span>
    </button>
    <button class="sidebar-btn flex items-center gap-3 w-full p-3 rounded-lg transition-colors hover:bg-gray-100" data-tab="leads">
      <i data-lucide="rocket" class="w-5 h-5 shrink-0"></i>
      <span class="hidden lg:inline lg:opacity-0 lg:group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap">Leads</span>
    </button>
    <button id="usuariosTabButton" class="sidebar-btn flex items-center gap-3 w-full p-3 rounded-lg transition-colors hover:bg-gray-100 hidden" data-tab="usuarios">
      <i data-lucide="users" class="w-5 h-5 shrink-0"></i>
      <span id="usuariosTabLabel" class="hidden lg:inline lg:opacity-0 lg:group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap"></span>
    </button>
  </nav>

  <div class="hidden lg:block mt-6 text-xs text-gray-500 px-3 lg:opacity-0 lg:group-hover:opacity-100 transition-opacity duration-200 space-y-1">
    <div>Empresa: <b id="empresaText">—</b></div>
    <div>Bot: <b id="botText">—</b></div>
  </div>
</aside>


<!-- Content -->
<main class="flex-1 w-full ml-0 md:ml-[72px] lg:ml-[72px] transition-all duration-300 lg:peer-hover:ml-[260px] flex justify-center">
<div id="appContainer" class="w-full max-w-6xl pt-8 pb-8 px-4 sm:px-6 lg:px-8">
              <!-- Login card -->
<div id="login" class="hidden w-full max-w-sm mx-auto mt-10 card p-6 text-center">
<img src="logo.svg" alt="Tomos Logo" class="w-32 h-auto mx-auto mb-4 rounded-lg" />
  
  <div class="flex items-center justify-center mb-4 gap-2">
    <h2 class="text-xl font-bold">Admin Access</h2>
  </div>

  <label class="block text-sm text-gray-600 mb-1 text-left">Email</label>
  <input id="emailInput" type="email" class="w-full border rounded-xl px-3 py-2 mb-3" placeholder="admin@company.com">
  <label class="block text-sm text-gray-600 mb-1 text-left">Password</label>
  <div class="relative mb-4">
    <input id="passwordInput" type="password" class="w-full border rounded-xl px-3 py-2 pr-10" placeholder="••••••••">
    <button type="button" id="togglePasswordVisibility" class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600" aria-pressed="false">
      <span class="sr-only">Mostrar contraseña</span>
      <i data-lucide="eye" class="w-4 h-4"></i>
    </button>
  </div>
  <button id="btnLogin" class="w-full py-2.5 rounded-xl bg-black text-white">Login</button>
  <p id="loginError" class="text-red-600 text-sm mt-3 hidden text-center">❌ Incorrect credentials</p>
</div>



        <!-- Tabs container -->
        <div id="tabs" class="hidden">
<!-- Dashboard -->
<section id="tab-dashboard" class="hidden space-y-6">
  <div id="dashboardBotsList" class="dashboard-bots-list">
    <div class="dashboard-bot-card loading">
      <p class="dashboard-bot-card-empty">Cargando bots…</p>
    </div>
  </div>
</section>

<!-- Dashboard 2 -->
<section id="tab-dashboard2" class="hidden">
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

    <!-- Total de Conversaciones -->
    <div class="dashboard2-card">
      <div class="dashboard2-card-header">
        <div class="dashboard2-card-title-group">
          <span class="">
            <i data-lucide="bot" class="w-5 h-5"></i>
          </span>
          <span id="dash2TotalConvTitle" class="dashboard2-card-title">Total Conversations</span>
        </div>
        <p id="dash2TotalConv" class="dashboard2-card-value">—</p>
      </div>
    </div>

    <!-- Knowledge Usage -->
    <div class="dashboard2-card">
      <div class="dashboard2-card-header flex items-center justify-between">
        <div class="dashboard2-card-title-group">
          <span class="">
            <i data-lucide="book-open" class="w-5 h-5"></i>
          </span>
          <span id="dash2KnowledgeTitle" class="dashboard2-card-title">Limit Knowledge</span>
        </div>
        <span id="dash2KnowledgeTextTop" class="text-sm text-gray-500 font-medium">23457 / 10000</span>
      </div>
      <div class="dashboard2-chart relative">
        <canvas id="dash2KnowledgeChart" width="140" height="140"></canvas>
        <span id="dash2KnowledgePercent" class="dashboard2-chart-value text-lg font-semibold text-gray-800">0%</span>
      </div>
    </div>

    <!-- Respuestas del mes -->
    <div class="dashboard2-card">
      <div class="dashboard2-card-header flex items-center justify-between">
        <div class="dashboard2-card-title-group">
          <span class="">
            <i data-lucide="message-square" class="w-5 h-5"></i>
          </span>
          <span id="dash2AnswersTitle" class="dashboard2-card-title">Limit Answers</span>
        </div>
        <span id="dash2AnswersTextTop" class="text-sm text-gray-500 font-medium">7 / 500</span>
      </div>
      <div class="dashboard2-chart relative">
        <canvas id="dash2AnswersChart" width="140" height="140"></canvas>
        <span id="dash2AnswersPercent" class="dashboard2-chart-value text-lg font-semibold text-gray-800">0%</span>
      </div>
    </div>

  </div>

  <!-- Gráfico de línea mensual -->
  <div class="dashboard2-panel mt-6">
    <div class="dashboard2-panel-header">
      <div class="dashboard2-card-title-group">
        <span class="">
          <i data-lucide="messages-square" class="w-5 h-5"></i>
        </span>
        <span id="dash2ConversationsTitle" class="dashboard2-card-title">Conversations</span>
      </div>
      <span id="dash2YearLabel" class="dashboard2-panel-subtitle"></span>
    </div>
    <div class="dashboard2-line-chart">
      <canvas id="dash2LineChart"></canvas>
    </div>
  </div>
</section>

<!-- Chat -->
<section id="tab-chat" class="space-y-8">
  <div class="flex justify-center">
    <div id="chatPanelTabs" class="flex flex-wrap items-center gap-2 p-1">
      <button class="chat-panel-tab active" data-chat-panel-tab="bot">
        <i data-lucide="bot" class="w-4 h-4"></i>
        <span>Bot</span>
      </button>
      <button class="chat-panel-tab" data-chat-panel-tab="activity">
        <i data-lucide="clock-3" class="w-4 h-4"></i>
        <span>Activity</span>
      </button>
      <button class="chat-panel-tab" data-chat-panel-tab="chat">
        <i data-lucide="message-square" class="w-4 h-4"></i>
        <span>Chat</span>
      </button>
      <button class="chat-panel-tab" data-chat-panel-tab="colors">
        <i data-lucide="palette" class="w-4 h-4"></i>
        <span>Colores</span>
      </button>
      <button class="chat-panel-tab" data-chat-panel-tab="widget">
        <i data-lucide="circle" class="w-4 h-4"></i>
        <span>Widget</span>
      </button>
      <button class="chat-panel-tab" data-chat-panel-tab="integration">
        <i data-lucide="code-2" class="w-4 h-4"></i>
        <span>Integration</span>
      </button>
    </div>
  </div>

  <div class="flex flex-col gap-8 md:grid md:grid-cols-2 xl:grid-cols-[260px,380px] xl:justify-center items-stretch md:items-start chat-columns">
    <div class="relative flex justify-center h-full w-full chat-column">
      <div class="space-y-6 h-full flex flex-col">
        <div class="iphone mx-auto">
          <div class="notch"></div>
          <div class="iphone-in relative">
            <iframe id="liveChatFrame"
              class="absolute inset-0 w-full h-full border-0 rounded-[26px]"
              sandbox="allow-same-origin allow-scripts allow-forms allow-popups"
              referrerpolicy="no-referrer-when-downgrade"></iframe>

            <div class="p-4 border-b flex items-center gap-3 hidden">
              <img id="previewLogo" class="h-7 w-7 rounded hidden" />
              <div class="font-medium">Chat Preview</div>
            </div>
            <div class="p-4 space-y-3 hidden" id="previewHolder">
              <button id="previewBtn" class="px-4 py-2 rounded text-white">Botón</button>
              <div id="previewBubble" class="p-3 rounded text-white inline-block">Mensaje</div>
            </div>
          </div>

          <div id="widgetExampleClone" class="widget-mockup shadow-lg absolute bottom-[-86px] z-10" style="right: 0;">
            <div id="widgetExampleIconClone" class="widget-icon-inline w-7 h-7"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="relative w-full xl:w-[380px] h-full flex flex-col chat-column">
      <div id="permBannerA" class="hidden card p-4 border border-amber-300/60 bg-amber-50">
        <div class="flex gap-2 items-start">
          <i data-lucide="shield-alert" class="w-5 h-5 text-amber-600"></i>
          <div class="text-sm text-amber-800">
            <b>Sin permisos de escritura.</b> Debes iniciar sesión con el email guardado en <code>config/adminEmail</code> o ser <code>globalAdmin</code>.
          </div>
        </div>
      </div>
      <div id="permBannerS" class="hidden card p-4 border border-amber-300/60 bg-amber-50">
        <div class="flex gap-2 items-start">
          <i data-lucide="shield-alert" class="w-5 h-5 text-amber-600"></i>
          <div class="text-sm text-amber-800">
            <b>Sin permisos de escritura.</b> Debes iniciar sesión con el email guardado en <code>config/adminEmail</code> o ser <code>globalAdmin</code>.
          </div>
        </div>
      </div>

      <div id="chatPanelContents" class="flex flex-col gap-6">
        <div data-chat-panel="bot" class="space-y-5">
          <div class="card p-6 space-y-6 relative overflow-visible">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2 font-semibold text-gray-800">
                <i data-lucide="bot" class="w-5 h-5"></i>
                Your Bot
              </div>
           
            </div>

            <div class="flex justify-center">
                <button id="botAvatarButton" type="button" class="relative group" aria-haspopup="dialog" aria-expanded="false">
                  <img id="botAvatarImage" src="avatars/1.png" alt="Bot avatar"
                    class="rounded-full shadow-lg border-4 border-white object-cover transition-transform duration-200 group-hover:scale-105" />
                <span class="absolute -bottom-2 -right-2 w-9 h-9 rounded-full bg-white shadow flex items-center justify-center border border-gray-200">
                  <i data-lucide="pencil" class="w-4 h-4 text-gray-600"></i>
                </span>
              </button>
            </div>

            <div class="text-center">
              <p id="botNameDisplay" class="text-lg font-semibold text-gray-800">Tomos Bot</p>
            </div>

            <div class="space-y-4">
              <div class="space-y-4">
                <div>
                  <label class="block text-xs font-semibold text-gray-600 uppercase tracking-wide">Name</label>
                  <input id="hotelName" class="mt-2 w-full border border-gray-200 rounded-xl px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-black/70" placeholder="Tomos Bot" />
                </div>
              </div>
              <div class="space-y-3">
                <label for="personalitySelect" class="block text-xs font-semibold text-gray-600 uppercase tracking-wide"></label>
                <div class="mt-2 relative">
                  <select id="personalitySelect" class="hidden">
                    <option value="friendly"></option>
                    <option value="professional"></option>
                    <option value="informal"></option>
                    <option value="informative"></option>
                    <option value="empathetic"></option>
                  </select>
                  <div id="personalityDropdown" class="relative">
                    <button type="button" id="personalityDropdownButton" class="personality-dropdown-button" aria-haspopup="listbox" aria-expanded="false">
                      <span class="personality-dropdown-label">
                        <span id="personalityDropdownIcon" class="personality-option-icon">
                          <i data-lucide="smile" class="w-4 h-4"></i>
                        </span>
                        <span id="personalityDropdownLabel" class="truncate"></span>
                      </span>
                      <i id="personalityDropdownChevron" data-lucide="chevron-down" class="w-4 h-4 text-gray-400"></i>
                    </button>
                    <div id="personalityDropdownMenu" class="personality-dropdown-menu hidden" role="listbox">
                      <button type="button" class="personality-option" data-personality-option="friendly" aria-pressed="false" role="option">
                        <span class="personality-option-icon"><i data-lucide="smile" class="w-5 h-5"></i></span>
                        <span class="personality-option-label"></span>
                        <i data-lucide="check" class="personality-option-check w-4 h-4"></i>
                      </button>
                      <button type="button" class="personality-option" data-personality-option="professional" aria-pressed="false" role="option">
                        <span class="personality-option-icon"><i data-lucide="briefcase" class="w-5 h-5"></i></span>
                        <span class="personality-option-label"></span>
                        <i data-lucide="check" class="personality-option-check w-4 h-4"></i>
                      </button>
                      <button type="button" class="personality-option" data-personality-option="informal" aria-pressed="false" role="option">
                        <span class="personality-option-icon"><i data-lucide="shirt" class="w-5 h-5"></i></span>
                        <span class="personality-option-label"></span>
                        <i data-lucide="check" class="personality-option-check w-4 h-4"></i>
                      </button>
                      <button type="button" class="personality-option" data-personality-option="informative" aria-pressed="false" role="option">
                        <span class="personality-option-icon"><i data-lucide="info" class="w-5 h-5"></i></span>
                        <span class="personality-option-label"></span>
                        <i data-lucide="check" class="personality-option-check w-4 h-4"></i>
                      </button>
                      <button type="button" class="personality-option" data-personality-option="empathetic" aria-pressed="false" role="option">
                        <span class="personality-option-icon"><i data-lucide="heart" class="w-5 h-5"></i></span>
                        <span class="personality-option-label"></span>
                        <i data-lucide="check" class="personality-option-check w-4 h-4"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="flex items-center justify-between gap-4 border border-gray-200 rounded-2xl px-4 py-3 bg-gray-50">
                <div>
                  <div class="flex items-center gap-2 font-semibold text-gray-800 text-sm">
                    <i data-lucide="message-circle" class="w-4 h-4"></i>
                    Enable
                  </div>
                  <p class="text-xs text-gray-500">Show the chat button on your site.</p>
                </div>
                <input id="tgChatVisible" type="checkbox" class="toggle" />
              </div>

              <div class="flex items-center justify-between gap-4 border border-gray-200 rounded-2xl px-4 py-3 bg-gray-50">
                <div>
                  <div class="flex items-center gap-2 font-semibold text-gray-800 text-sm">
                    <i data-lucide="users" class="w-4 h-4"></i>
                    <span id="leadCaptureTitle"></span>
                  </div>
                  <p id="leadCaptureDescription" class="text-xs text-gray-500"></p>
                </div>
                <input id="tgLeadCapture" type="checkbox" class="toggle" />
              </div>
            </div>

          </div>

        </div>

        <div data-chat-panel="activity" class="space-y-5 hidden">
          <div class="card p-5 space-y-4">
            <div class="font-semibold flex items-center gap-2 mb-2">
              <i data-lucide="clock" class="w-5 h-5"></i>
              Schedule
            </div>
            <p class="text-sm text-gray-500">Define the periods of activity. Changes are saved automatically.</p>
            <div id="scheduleList" class="space-y-3"></div>
            <div class="pt-2 border-t border-gray-200">
              <label class="block text-xs font-semibold text-gray-600 uppercase tracking-wide">Time Zone</label>
              <select id="timeZone" class="mt-2 w-full border border-gray-200 rounded-xl px-4 py-2.5 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-black/70"></select>
            </div>
          </div>
        </div>

        <div data-chat-panel="chat" class="space-y-5 hidden">
          <div class="card p-5 space-y-6">
            <div class="space-y-1">
              <div class="flex items-center gap-2 font-semibold text-gray-800">
                <i data-lucide="messages-square" class="w-5 h-5"></i>
                Chat
              </div>
            </div>

      <div class="space-y-6">
  <div class="space-y-3">

    <div class="flex flex-wrap items-center justify-between gap-3">

      <!-- IZQUIERDA -->
      <span id="chatHeaderSectionTitle" class="text-xs font-semibold text-gray-500 uppercase tracking-wide select-none"></span>

      <!-- DERECHA: toggle + badge + botón -->
      <div class="flex items-center gap-2">
        <input id="tgChatHeaderVisible" type="checkbox" class="toggle toggle-sm" />

        <span id="chatHeaderToggleStatus"
              class="px-2.5 py-1 rounded-full text-xs font-medium bg-emerald-100 text-emerald-700">
        </span>

        <button id="openHeaderPanel" type="button"
          class="p-2 rounded-full border border-gray-200 text-gray-500 hover:text-gray-700 hover:border-gray-300 transition">
          <i data-lucide="pencil" class="w-4 h-4"></i>
        </button>
      </div>

    </div>

    <div class="border border-gray-200 bg-white rounded-2xl p-4 flex items-center gap-4 shadow-sm">
      <div class="w-14 h-14 rounded-xl bg-gray-100 flex items-center justify-center text-gray-500 relative overflow-hidden">
        <img id="headerSummaryImage" class="absolute inset-0 w-full h-full rounded-xl object-cover hidden" alt="Header logo preview" />
        <i data-lucide="message-square-text" class="w-5 h-5" id="headerSummaryIcon"></i>
      </div>
      <div class="flex-1 min-w-0">
        <p id="headerSummaryTitle" class="text-sm font-medium text-gray-800 truncate">Tomos Bot</p>
        <p id="headerSummaryDescription" class="text-xs text-gray-500"></p>
      </div>
    </div>

  </div>
</div>


           <div class="space-y-3">
  <div class="flex flex-wrap items-center justify-between gap-3">

    <!-- IZQUIERDA -->
    <span id="welcomeSectionTitle" class="text-xs font-semibold text-gray-500 uppercase tracking-wide select-none"></span>

    <!-- DERECHA: toggle + badge + botón -->
    <div class="flex items-center gap-2">
      <input type="checkbox" id="welcomeEnabled" class="toggle toggle-sm" />

      <span id="welcomeSummaryBadge" class="px-2.5 py-1 rounded-full text-xs font-medium bg-gray-200 text-gray-600"></span>

      <button id="openWelcomePanel" type="button"
        class="p-2 rounded-full border border-gray-200 text-gray-500 hover:text-gray-700 hover:border-gray-300 transition">
        <i data-lucide="pencil" class="w-4 h-4"></i>
      </button>
    </div>

  </div>

  <div id="welcomeSummaryCard"
    class="border border-gray-200 bg-white rounded-2xl p-4 flex items-start gap-4 shadow-sm">
    <div class="w-14 h-14 rounded-xl bg-gray-100 flex items-center justify-center text-gray-500 relative overflow-hidden">
      <img id="welcomeSummaryImage"
        class="absolute inset-0 w-full h-full rounded-xl object-cover hidden"
        alt="Welcome message image" />
      <i data-lucide="sparkles" class="w-5 h-5" id="welcomeSummaryIcon"></i>
    </div>
    <div class="flex-1 space-y-2 text-sm">
      <div class="rounded-xl bg-gray-50 px-3 py-2 text-gray-700 leading-relaxed">
        <p id="welcomeSummaryText" class="leading-relaxed text-gray-700"></p>
      </div>
    </div>
  </div>
</div>


              <div class="space-y-3">
                <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Font</p>
                <select id="fontFamily" class="border border-gray-200 rounded-xl px-3 py-2 w-full text-sm bg-white focus:outline-none focus:ring-2 focus:ring-black/60">
                  <option value="Manrope">Manrope</option>
                  <option value="Inter">Inter</option>
                  <option value="Poppins">Poppins</option>
                  <option value="Roboto">Roboto</option>
                  <option value="Playfair Display">Playfair Display</option>
                  <option value="Merriweather">Merriweather</option>
                </select>
              </div>

            </div>
          </div>

          <div class="card p-5 space-y-4 hidden">
            <div class="font-semibold flex items-center gap-2 mb-3"><i data-lucide="link-2" class="w-5 h-5"></i> Link para probar el chat</div>
            <div class="flex items-center gap-3 flex-wrap">
              <input id="chatTestLink" type="text" readonly class="flex-1 min-w-[200px] border rounded-lg px-3 py-2 text-sm bg-gray-50 select-all"/>
              <div class="flex items-center gap-2">
                <button id="copyChatLink" class="px-3 py-2 bg-black text-white text-sm rounded-lg">Copiar</button>
                <button id="openChatLink" class="px-3 py-2 bg-black text-white text-sm rounded-lg">Abrir</button>
              </div>
            </div>
            <p class="text-xs text-gray-500">El enlace se genera automáticamente con el nombre de tu empresa actual.</p>
          </div>
        </div>

        <div data-chat-panel="colors" class="space-y-5 hidden">
          <div class="card p-6 space-y-6">
            <div class="flex items-center gap-2 font-semibold text-gray-800">
              <i data-lucide="palette" class="w-5 h-5"></i>
              Colores
            </div>

            <div class="space-y-3">
              <div class="flex items-center justify-between gap-3">
                <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Colors</p>
                <button id="toggleTemplatePanel" type="button" class="flex items-center gap-2 px-3 py-1.5 border border-gray-200 rounded-full text-xs font-medium text-gray-600 bg-white shadow-sm hover:text-gray-900 hover:border-gray-300 transition">
                  <i data-lucide="palette" class="w-3.5 h-3.5"></i>
                  <span>Template</span>
                </button>
              </div>
              <p class="text-xs text-gray-500">Selecciona un estilo predefinido en la ventana emergente. Puedes ajustar los colores luego.</p>
              <div class="space-y-4">
                <div>
                  <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Encabezado</p>
                  <div class="grid gap-3 md:grid-cols-2 mt-2">
                    <div class="flex items-center gap-3 border border-gray-200 rounded-2xl px-3 py-3 bg-white shadow-sm">
                      <input id="chatHeaderColor" type="color" class="color-circle rounded-full border border-gray-200 shadow-sm cursor-pointer">
                      <span class="text-sm font-medium text-gray-600 select-none">Fondo del encabezado</span>
                    </div>
                    <div class="flex items-center gap-3 border border-gray-200 rounded-2xl px-3 py-3 bg-white shadow-sm">
                      <input id="chatHeaderTextColor" type="color" class="color-circle rounded-full border border-gray-200 shadow-sm cursor-pointer">
                      <span class="text-sm font-medium text-gray-600 select-none">Texto del encabezado</span>
                    </div>
                  </div>
                </div>
                <div>
                  <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Chat</p>
                  <div class="grid gap-3 md:grid-cols-2 mt-2">
                    <div class="flex items-center gap-3 border border-gray-200 rounded-2xl px-3 py-3 bg-white shadow-sm">
                      <input id="chatBackgroundColor" type="color" class="color-circle rounded-full border border-gray-200 shadow-sm cursor-pointer">
                      <span class="text-sm font-medium text-gray-600 select-none">Fondo del chat</span>
                    </div>
                    <div class="flex items-center gap-3 border border-gray-200 rounded-2xl px-3 py-3 bg-white shadow-sm">
                      <input id="chatAssistantTextColor" type="color" class="color-circle rounded-full border border-gray-200 shadow-sm cursor-pointer">
                      <span class="text-sm font-medium text-gray-600 select-none">Color del texto</span>
                    </div>
                  </div>
                </div>
                <div>
                  <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Cliente</p>
                  <div class="grid gap-3 md:grid-cols-2 mt-2">
                    <div class="flex items-center gap-3 border border-gray-200 rounded-2xl px-3 py-3 bg-white shadow-sm">
                      <input id="chatPrimaryColor" type="color" class="color-circle rounded-full border border-gray-200 shadow-sm cursor-pointer">
                      <span class="text-sm font-medium text-gray-600 select-none">Fondo del cliente</span>
                    </div>
                    <div class="flex items-center gap-3 border border-gray-200 rounded-2xl px-3 py-3 bg-white shadow-sm">
                      <input id="chatClientTextColor" type="color" class="color-circle rounded-full border border-gray-200 shadow-sm cursor-pointer">
                      <span class="text-sm font-medium text-gray-600 select-none">Texto del cliente</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div data-chat-panel="widget" class="space-y-5 hidden">
          <div class="card p-5 space-y-6">
            <div class="flex items-center gap-2 font-semibold text-gray-800">
              <i data-lucide="mouse-pointer" class="w-5 h-5"></i>
              Widget
            </div>
            <div class="space-y-4">
              <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Icon</p>
              <div class="flex justify-center">
                <button type="button" id="widgetIconTrigger" class="widget-icon-trigger" title="Elegir icono">
                  <div id="widgetIconTriggerImg" class="widget-icon-inline"></div>
                </button>
              </div>

            <div class="space-y-4">
              <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Colors</p>
                           <div class="flex items-center gap-4">
                <input id="widgetIconColor" type="color" value="#ffffff" class="color-circle rounded-full cursor-pointer border border-gray-300 shadow-sm" />
                <span id="widgetIconColorLabel" class="text-sm font-medium text-gray-600 select-none"></span>
              </div>
              <div class="flex items-center gap-4">
                <input id="chatButtonColor" type="color" class="color-circle rounded-full cursor-pointer border border-gray-300 shadow-sm" />
                <span class="text-sm font-medium text-gray-600 select-none">Widget Background</span>
              </div>
            </div>
 

              <div class="flex items-center gap-3">
                <label class="flex items-center gap-2 text-sm text-gray-600 select-none">
                  <input type="checkbox" id="widgetRounded" class="rounded border-gray-300" />
                  Rounded
                </label>
                <input type="range" id="widgetRadius" min="0" max="50" value="20" class="flex-1 accent-blue-500">
                <span id="widgetRadiusVal" class="text-sm text-gray-600 inline-block text-right min-w-[2ch]">20</span>
              </div>
            </div>

            <div class="space-y-3">
              <p id="widgetPositionLabel" class="text-xs font-semibold text-gray-500 uppercase tracking-wide"></p>
              <div class="flex items-center justify-center gap-2 border border-gray-200 rounded-2xl px-3 py-2 bg-gray-50 shadow-sm">
                <div class="flex items-center gap-8">
                  <button type="button" data-position="left" class="widget-position-btn w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center text-gray-600 hover:bg-gray-100">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                  </button>
                  <button type="button" data-position="center" class="widget-position-btn w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center text-gray-600 hover:bg-gray-100">
                    <i data-lucide="arrow-down" class="w-5 h-5"></i>
                  </button>
                  <button type="button" data-position="right" class="widget-position-btn w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center text-gray-600 hover:bg-gray-100">
                    <i data-lucide="arrow-right" class="w-5 h-5"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div data-chat-panel="integration" class="space-y-5 hidden">
          <div class="card p-5 space-y-4">
            <div class="font-semibold flex items-center gap-2 mb-1">
              <i data-lucide="code-2" class="w-5 h-5"></i>
              Integration Script
            </div>
            <p class="text-sm text-gray-500">
              Copy and paste this code into your website just before the <code>&lt;/body&gt;</code> tag.
              The chat will automatically appear with your hotel's configuration.
            </p>
            <div class="relative">
              <textarea id="embedScriptBox" readonly class="w-full text-sm font-mono bg-gray-50 border rounded-lg p-3 pr-16 focus:outline-none select-all resize-none"></textarea>
              <button id="copyEmbedScript" class="absolute top-3 right-3 px-3 py-1.5 text-sm bg-black text-white rounded-md">Copy</button>
            </div>
          </div>

          <div class="card p-5 space-y-4">
            <div class="font-semibold flex items-center gap-2 mb-1">
              <i data-lucide="shield-check" class="w-5 h-5"></i>
              <span id="allowedSitesTitle"></span>
            </div>
            <p id="allowedSitesDescription" class="text-sm text-gray-500"></p>
            <div class="flex flex-col sm:flex-row gap-3">
              <input id="allowedUrlInput" type="url" class="flex-1 border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black" />
              <button id="addAllowedUrl" class="px-4 py-2 bg-black text-white text-sm rounded-lg whitespace-nowrap"></button>
            </div>
            <div id="allowedUrlsList" class="space-y-2"></div>
          </div>
        </div>
      </div>

      <div id="headerSettingsOverlay" class="hidden fixed inset-0 bg-black/30 z-40"></div>
      <div id="headerSettingsPanel" class="hidden fixed inset-0 z-50 flex items-center justify-center px-4">
        <div class="card p-5 shadow-2xl w-full max-w-md">
          <div class="flex items-center justify-between mb-5">
            <div class="flex items-center gap-2 font-semibold text-gray-800">
              <i data-lucide="panel-top" class="w-5 h-5"></i>
              Header
            </div>
            <button type="button" id="closeHeaderPanel" class="p-2 rounded-full hover:bg-gray-100 text-gray-500 transition">
              <i data-lucide="x" class="w-4 h-4"></i>
            </button>
          </div>
          <div class="space-y-6">
            <div class="space-y-4">
              <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Image</p>
              <div class="space-y-4">
                <div id="logoControls" class="flex flex-wrap gap-3 justify-center">
                  <label class="inline-flex items-center justify-center px-4 py-2 bg-black text-white rounded cursor-pointer text-sm hover:bg-gray-800 transition">
                    Select file
                    <input id="logoFile" type="file" accept="image/*" class="hidden" />
                  </label>
                </div>
                <div id="logoPreviewWrap" class="hidden">
                  <div class="relative w-24 h-24 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center shadow mx-auto">
                    <img id="logoPreview" class="w-full h-full object-cover" alt="Logo" />
                    <button id="deleteLogo" class="absolute bottom-1 right-1 bg-red-600 text-white p-1.5 rounded-full shadow hover:bg-red-700 transition">
                      <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                  </div>
                </div>
                <div class="flex items-center gap-3">
                  <label class="flex items-center gap-2 text-sm text-gray-600 select-none">
                    <input type="checkbox" id="headerRounded" class="rounded border-gray-300" />
                    Rounded
                  </label>
                  <input type="range" id="logoRadius" min="0" max="50" value="23" class="flex-1 accent-blue-500">
                  <span id="logoRadiusVal" class="text-sm text-gray-600 w-8 text-right">23</span>
                </div>
                <p id="msgLogo" class="text-green-600 text-sm hidden">✔ Header image updated</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="avatarSettingsOverlay" class="hidden fixed inset-0 bg-black/30 z-40"></div>
      <div id="avatarPopover" class="hidden fixed inset-0 z-50 flex items-center justify-center px-4">
        <div class="card p-5 shadow-2xl space-y-5 w-full max-w-[20em]">
          <div class="flex items-center justify-between">
            <p class="font-semibold text-gray-800">Avatar</p>
            <button type="button" id="closeAvatarPopover" class="p-1.5 rounded-full hover:bg-gray-100 text-gray-500 transition">
              <i data-lucide="x" class="w-4 h-4"></i>
            </button>
          </div>
          <div id="avatarControls" class="space-y-4">
            <div class="flex items-center gap-3 flex-wrap">
              <button type="button" class="avatar-option active" data-avatar-option="avatars/1.png">
                <img src="avatars/1.png" alt="Avatar 1" />
              </button>
              <button type="button" class="avatar-option" data-avatar-option="avatars/2.png">
                <img src="avatars/2.png" alt="Avatar 2" />
              </button>
              <button type="button" class="avatar-option" data-avatar-option="avatars/3.png">
                <img src="avatars/3.png" alt="Avatar 3" />
              </button>
              <div class="relative">
                <label id="customAvatarOption" class="avatar-option avatar-upload cursor-pointer" data-avatar-option="">
                  <i id="customAvatarPlus" data-lucide="plus" class="w-5 h-5 text-gray-500"></i>
                  <img id="customAvatarImage" src="" alt="Avatar personalizado" class="hidden" />
                  <input id="avatarFile" type="file" accept="image/*" class="hidden" />
                </label>
                <button type="button" id="deleteAvatar" class="hidden absolute -right-1 -bottom-1 bg-red-600 text-white p-1 rounded-full shadow hover:bg-red-700 transition">
                  <i data-lucide="trash-2" class="w-4 h-4"></i>
                </button>
              </div>
            </div>
            <div class="flex items-center gap-3">
              <label class="flex items-center gap-2 text-sm text-gray-600 select-none">
                <input type="checkbox" id="avatarRounded" class="rounded border-gray-300" />
                Rounded
              </label>
              <input type="range" id="avatarRadius" min="0" max="50" value="50" class="flex-none w-28 accent-blue-500">
              <span id="avatarRadiusVal" class="text-sm text-gray-600 min-w-[2ch] text-right">50</span>
            </div>
          </div>
        </div>
      </div>

      <div id="welcomeSettingsOverlay" class="hidden fixed inset-0 bg-black/30 z-40"></div>
      <div id="welcomeSettingsPanel" class="hidden fixed inset-0 z-50 flex items-center justify-center px-4">
        <div class="card p-5 shadow-2xl space-y-5 w-full max-w-md">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2 font-semibold text-gray-800">
              <i data-lucide="sparkles" class="w-5 h-5"></i>
              Welcome message
            </div>
            <button type="button" id="closeWelcomePanel" class="p-2 rounded-full hover:bg-gray-100 text-gray-500 transition">
              <i data-lucide="x" class="w-4 h-4"></i>
            </button>
          </div>

          <div class="space-y-5">
            <div class="space-y-2" >
              <label for="welcomeText" class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Message</label>
              <textarea id="welcomeText" class="w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black/60 h-[100px] max-h-[100px]" rows="4" placeholder="Enter welcome message..." style=" min-height: 100px; "></textarea>
            </div>

            <div class="space-y-2">
              <label for="welcomeDelay" class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Delay (seconds)</label>
              <input id="welcomeDelay" type="number" min="0" class="border rounded-lg px-3 py-2 text-sm w-28 focus:outline-none focus:ring-2 focus:ring-black/60" value="2">
            </div>

            <div class="space-y-3">
              <label for="welcomeImageFile" class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Welcome image (optional)</label>
              <input id="welcomeImageFile" type="file" accept="image/*" class="text-sm">
              <div class="relative">
                <img id="welcomePreview" class="rounded-xl w-full max-h-40 object-cover hidden" />
                <button id="removeWelcomeImage" type="button" class="hidden absolute top-3 right-3 bg-white/90 text-gray-700 hover:text-red-600 hover:bg-white shadow rounded-full p-1 transition" aria-label="Remove welcome image">
                  <i data-lucide="trash-2" class="w-4 h-4"></i>
                </button>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- MENSAJES TAB -->
<section id="tab-mensajes" class="hidden">
  <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-[320px,1fr]">
    <div class="card p-4 flex flex-col h-[620px]">
      <div class="flex flex-col gap-3">
        <div>
          <label for="messagesBotFilter" class="text-xs font-semibold text-gray-500 uppercase tracking-wide block mb-1">Bot</label>
          <select id="messagesBotFilter" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-black/60" disabled></select>
        </div>
        <div class="relative">
          <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"></i>
          <input id="messagesSearchInput" type="text" placeholder="Buscar conversaciones" class="w-full pl-9 pr-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-black/60" />
        </div>
      </div>
      <div class="mt-3">
        <button id="deleteOldMessages" type="button" class="w-full flex items-center justify-center gap-2 text-xs font-medium text-red-600 border border-red-100 rounded-lg px-3 py-2 hover:bg-red-50 transition">
          <i data-lucide="trash-2" class="w-4 h-4"></i>
          <span>Eliminar conversaciones antiguas</span>
        </button>
      </div>
      <div id="messagesEmpty" class="text-sm text-gray-500 text-center mt-6 hidden">No hay conversaciones</div>
      <div id="messagesList" class="mt-4 flex-1 overflow-y-auto space-y-2 pr-1"></div>
    </div>
    <div class="card p-4 h-[620px] flex flex-col">
      <div id="messagesConversationHeader" class="pb-3 border-b border-gray-200 mb-3 hidden">
        <div class="flex items-start justify-between gap-3">
          <div id="messagesUserName" class="text-lg font-semibold text-gray-800 truncate"></div>
          <div class="flex flex-col items-end gap-1 text-right">
            <div id="messagesUserLocation" class="text-xs text-gray-500 leading-tight"></div>
            <div id="messagesUpdatedAt" class="text-xs text-gray-500"></div>
          </div>
        </div>
      </div>
      <div id="messagesPlaceholder" class="flex-1 flex items-center justify-center text-sm text-gray-500 text-center px-6">
        Selecciona una conversación para ver los mensajes.
      </div>
      <div id="messagesDetail" class="flex-1 overflow-y-auto space-y-3 hidden"></div>
    </div>
  </div>
</section>

<!-- KNOWLEDGE TAB -->
          <section id="tab-knowledge" class="hidden space-y-6 max-w-3xl">
  <div class="card p-5 space-y-4">
    <div class="font-semibold flex items-center gap-2">
      <i data-lucide="book-open" class="w-5 h-5"></i>
      Knowledge
    </div>
    <p class="text-sm text-gray-500">
      Add the contextual information that helps the assistant understand your business, products, and brand tone. You can import pages from a URL and edit them here.
    </p>

    <div class="flex flex-wrap items-center gap-2">
      <div id="knowledgeTabs" class="flex flex-wrap items-center gap-2"></div>
      <button id="addKnowledgePage" class="flex items-center gap-1.5 px-3 py-1.5 text-sm bg-black text-white rounded-lg shadow-sm hover:bg-gray-900 transition">
        <i data-lucide="plus" class="w-4 h-4"></i>
        Add
      </button>
    </div>

    <div id="knowledgeUrlMeta" class="text-xs text-gray-500 hidden">
      <span class="font-medium">Source:</span>
      <span id="knowledgeCurrentUrl" class="truncate"></span>
    </div>

    <textarea id="contextText"
      class="w-full border border-gray-200 rounded-xl p-3 text-sm min-h-[400px] overflow-y-auto focus:outline-none focus:ring-2 focus:ring-black/70 resize-none"
      placeholder="Add your knowledge here... (max 10,000 characters)"></textarea>

    <div class="flex items-center justify-between text-xs">
      <span id="ctxCounter" class="text-gray-500">0 / 10000 characters</span>
      <div class="flex items-center gap-2">
        <button
          id="deleteKnowledgePage"
          class="px-3 py-2 border border-gray-300 rounded-md text-sm flex items-center gap-1 text-gray-600 hover:text-red-600 hover:border-red-300 transition"
          title="Delete page"
          aria-label="Delete knowledge page"
        >
          <i data-lucide="trash-2" class="w-4 h-4"></i>
        </button>
        <button id="saveContext" class="px-4 py-2 bg-black text-white rounded-md text-sm">Save</button>
      </div>
    </div>

    <p id="msgContext" class="text-green-600 text-sm hidden">✔ Saved</p>
  </div>
</section>




<!-- RESPUESTAS TAB -->
<section id="tab-respuestas" class="hidden space-y-6 max-w-3xl">
  <div class="card p-6 space-y-5">
    <div class="flex flex-col gap-3">
      <div class="flex items-center justify-between gap-3">
        <div class="font-semibold flex items-center gap-2">
          <i data-lucide="messages-square" class="w-5 h-5"></i>
          Auto Responses
        </div>
        <button id="addAutoResponse" class="px-4 py-2 bg-black text-white rounded-md flex items-center gap-2 text-sm">
          <span class="text-lg leading-none">+</span>
          <span>Add</span>
        </button>
      </div>
      <p class="text-sm text-gray-500">
        Organize quick replies for frequent questions. Create as many tabs as you need, customise their content and preview how they will look in the chat widget.
      </p>

      <div id="autoResponseTabs" class="flex w-full items-center gap-2 overflow-x-auto pb-1 flex-nowrap"></div>

      <div id="autoResponseEmpty" class="border border-dashed border-gray-300 rounded-2xl p-6 text-center text-gray-500 text-sm">
        Start by creating your first tab to design an automated reply.
      </div>

      <div id="autoResponsePlaceholder" class="hidden border border-dashed border-gray-300 rounded-2xl p-6 text-center text-gray-500 text-sm">
        Select a tab to review or edit its configuration.
      </div>

      <div id="autoResponseEditor" class="hidden space-y-5">
        <div class="bg-white border border-gray-200 rounded-2xl shadow-sm p-5 space-y-5">
          <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-[2fr,1fr] lg:items-start">
            <div class="space-y-2">
              <label class="text-xs font-medium text-gray-600 uppercase tracking-wide">Keyword</label>
              <input id="autoResponseKeyword" type="text" placeholder="(e.g. spa, restaurant)"
                     class="w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black/60">
              <p class="text-[12px] text-gray-500">When the guest mentions this keyword, the auto response will be triggered.</p>
            </div>
            <div class="space-y-2">
              <label class="text-xs font-medium text-gray-600 uppercase tracking-wide">Response type</label>
              <select id="autoResponseType" class="w-full border rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black/60 bg-white shadow-sm transition">
                <option value="text">Text</option>
                <option value="cards">Cards</option>
                <option value="menu">Menu</option>
              </select>
            </div>
          </div>

          <div id="textEditor" class="space-y-4">
            <div>
              <label class="block text-xs font-semibold text-gray-600 mb-1">Message</label>
              <textarea id="autoResponseText" rows="3" placeholder="Write the automatic response..."
                        class="w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black/60" style=" min-height: 100px; "></textarea>
            </div>
            <div class="grid gap-3 md:grid-cols-2">
              <div>
                <label class="block text-xs font-semibold text-gray-600 mb-1">Title</label>
                <input id="autoResponseTitle" type="text" class="w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black/60">
              </div>
              <div>
                <label class="block text-xs font-semibold text-gray-600 mb-1">Subtitle</label>
                <input id="autoResponseSubtitle" type="text" class="w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black/60">
              </div>
            </div>
            <div>
              <label class="block text-xs font-semibold text-gray-600 mb-1">Image URL (optional)</label>
              <input id="autoResponseImage" type="text" class="w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black/60" placeholder="https://...">
            </div>
            <div>
              <div class="flex items-center justify-between">
                <span class="text-sm font-semibold text-gray-700">Buttons</span>
                <button id="addTextButton" class="text-xs px-2 py-1 rounded-lg bg-gray-200 hover:bg-gray-300 transition">+ Add button</button>
              </div>
              <div id="textButtonsList" class="mt-2 space-y-2"></div>
            </div>
            <div>
              <span class="text-sm font-semibold text-gray-700">Live preview</span>
              <div id="textPreview" class="mt-2 bg-gray-50 border border-gray-200 rounded-2xl p-4 flex justify-center"></div>
            </div>
          </div>

          <div id="cardsEditor" class="space-y-3 hidden">
            <div class="flex items-center justify-between">
              <span class="text-sm font-semibold text-gray-700">Cards</span>
              <button id="addCardButton" class="text-xs px-3 py-1 rounded-lg bg-gray-200 hover:bg-gray-300 transition">+ Add card</button>
            </div>
            <div id="cardsList" class="space-y-3"></div>
          </div>

          <div id="menuEditor" class="space-y-3 hidden">
            <div>
              <label class="block text-xs font-semibold text-gray-600 mb-1">Intro text</label>
              <input id="menuIntroText" type="text" class="w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black/60" placeholder="Choose an option">
            </div>
            <div>
              <div class="flex items-center justify-between">
                <span class="text-sm font-semibold text-gray-700">Buttons</span>
                <button id="addMenuButton" class="text-xs px-3 py-1 rounded-lg bg-gray-200 hover:bg-gray-300 transition">+ Add button</button>
              </div>
              <div id="menuButtonsList" class="mt-2 space-y-2"></div>
            </div>
            <div>
              <span class="text-sm font-semibold text-gray-700">Preview</span>
              <div id="menuPreview" class="mt-2 bg-gray-50 border border-gray-200 rounded-2xl p-4 flex flex-wrap gap-2"></div>
            </div>
          </div>

          <div class="flex justify-end items-center gap-3">
            <button id="saveAutoResponses" class="px-4 py-2 bg-black text-white rounded-md flex items-center gap-2 text-sm">
              <i data-lucide="save"></i> Save changes
            </button>
            <button id="deleteAutoResponse" class="p-2 rounded-lg text-red-600 hover:text-red-700 hover:bg-red-50 transition"
                    aria-label="Delete this tab" title="Delete this tab">
              <i data-lucide="trash-2" class="w-4 h-4"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <p id="msgAutoResponses" class="text-green-600 text-sm hidden">✔ Saved</p>
  </div>
</section>

<div id="autoResponseTypeModal"
     class="fixed inset-0 hidden flex items-center justify-center bg-black/45 backdrop-blur-sm z-[1200] px-4"
     aria-hidden="true">

  <div id="autoResponseTypeModalPanel"
       class="type-modal-panel w-full max-w-3xl p-6 space-y-6"
       role="dialog"
       aria-modal="true"
       aria-labelledby="autoResponseTypeTitle">

    <div class="type-modal-accent"></div>

    <div class="type-modal-header flex items-start justify-between gap-4">
      <div class="space-y-1">
        <h3 id="autoResponseTypeTitle" class="text-xl font-semibold text-gray-900">
          Seleccionar tipo de respuesta automática
        </h3>
        <p id="autoResponseTypeSubtitle" class="text-sm text-gray-600">
          Elige el formato ideal para la nueva respuesta automática.
        </p>
      </div>
      <button id="cancelAutoResponseTypeTop"
              class="modal-secondary px-3 py-2 text-sm font-medium flex items-center gap-2">
        <i data-lucide="x" class="w-4 h-4"></i>
        <span>Cancel</span>
      </button>
    </div>

    <div class="grid gap-3 sm:grid-cols-3 relative z-[1]">

      <button type="button"
              class="type-option-card text-left p-4 flex flex-col gap-3"
              data-response-type="text">
        <div class="type-option-icon">
          <img src="respuestas/texto.svg" alt="Texto"  />
        </div>
        <div class="space-y-1">
          <div class="font-semibold">Text</div>
          <p class="type-option-description text-sm leading-relaxed">
            Mensaje de texto rápido con botones opcionales.
          </p>
        </div>
      </button>

      <button type="button"
              class="type-option-card text-left p-4 flex flex-col gap-3"
              data-response-type="cards">
        <div class="type-option-icon">
          <img src="respuestas/tarjetas.svg" alt="Tarjetas"  />
        </div>
        <div class="space-y-1">
          <div class="font-semibold">Cards</div>
          <p class="type-option-description text-sm leading-relaxed">
            Carrusel de tarjetas con imagen, título y acción.
          </p>
        </div>
      </button>

      <button type="button"
              class="type-option-card text-left p-4 flex flex-col gap-3"
              data-response-type="menu">
        <div class="type-option-icon">
          <img src="respuestas/menu.svg" alt="Menú" />
        </div>
        <div class="space-y-1">
          <div class="font-semibold">Menu</div>
          <p class="type-option-description text-sm leading-relaxed">
            Menú de opciones rápidas para que el usuario elija.
          </p>
        </div>
      </button>

    </div>

    <div class="flex justify-end gap-3 type-modal-actions relative z-[1]">
      <button id="cancelAutoResponseType"
              class="modal-secondary px-4 py-2 text-sm font-medium">
        Cancel
      </button>
      <button id="confirmAutoResponseType"
              class="modal-primary px-4 py-2 text-sm font-medium flex items-center gap-2"
              disabled>
        <span>Create</span>
        <i data-lucide="arrow-right" class="w-4 h-4"></i>
      </button>
    </div>

  </div>
</div>


<section id="tab-prompt" class="hidden">
  <div class="card p-6 space-y-4 max-w-3xl mx-auto">
    <h2 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
              <i data-lucide="file-text" class="w-5 h-5 text-gray-800"></i>

      <span id="promptSectionTitle" class="leading-none"></span>
    </h2>
    <p id="promptSectionDescription" class="text-sm text-gray-500"></p>
    <textarea id="promptTextarea" class="w-full border border-gray-200 rounded-xl p-3 text-sm min-h-[400px] focus:outline-none focus:ring-2 focus:ring-black/70" placeholder="" style=" overflow-y: auto;     /* permite scroll vertical */ white-space: pre-wrap; "></textarea>
    <button id="savePromptBtn" class="bg-black text-white rounded-xl px-4 py-2.5 hover:bg-gray-900"></button>
  </div>
</section>

<section id="tab-leads" class="hidden space-y-6">
  <div class="card p-5 space-y-4">
    <div class="flex flex-wrap items-start justify-between gap-4">
      <div>
        <h2 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
                      <i data-lucide="rocket" class="w-5 h-5 text-gray-800"></i>

          <span class="leading-none">Leads</span>
        </h2>
        <p class="text-sm text-gray-500">Contactos capturados desde el chat. La lista se actualiza automáticamente.</p>
      </div>
      <div class="flex items-center gap-3 text-xs font-medium text-gray-500">
    
        <button id="exportLeadsButton" type="button" class="inline-flex items-center gap-2 rounded-full border border-gray-200 px-4 py-2 text-xs font-semibold text-gray-700 transition hover:bg-gray-100">
          Exportar CSV
        </button>
      </div>
    </div>

    <div class="mt-2 overflow-x-auto -mx-1 sm:mx-0">
      <table class="min-w-full text-sm text-gray-700">
        <thead class="text-xs uppercase tracking-wide text-gray-500">
          <tr>
            <th scope="col" class="px-4 py-3 text-left">Nombre</th>
            <th scope="col" class="px-4 py-3 text-left">Contacto</th>
            <th scope="col" class="px-4 py-3 text-left">Resumen</th>
            <th scope="col" class="px-4 py-3 text-left">Fecha</th>
            <th scope="col" class="px-4 py-3 text-left">Acciones</th>
          </tr>
        </thead>
        <tbody id="leadsTableBody"></tbody>
      </table>
    </div>

    <div id="leadsEmptyState" class="text-sm text-gray-500 text-center py-6 hidden">
      Aún no hay leads registrados para este bot.
    </div>
  </div>
</section>

<section id="tab-usuarios" class="hidden space-y-6 max-w-4xl mx-auto">
  <div class="card p-5 space-y-4">
    <div class="flex items-center justify-between">
      <h3 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
                  <i data-lucide="users" class="w-5 h-5 text-gray-800"></i>

        <span id="userAccessTitle" class="leading-none"></span>
      </h3>
      <span id="userAccessSummary" class="text-sm text-gray-500">—</span>
    </div>
    <p id="userBotSelectStatus" class="text-sm text-gray-500"></p>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200 text-sm">
        <thead class="bg-gray-50 text-xs font-semibold tracking-wide text-gray-500">
          <tr>
            <th scope="col" class="px-4 py-2 text-left">
              <div class="flex items-center gap-2">
                <i data-lucide="mail" class="w-4 h-4 text-gray-500"></i>
                <span id="userTableEmailHeader"></span>
              </div>
            </th>
            <th scope="col" class="px-4 py-2 text-left">
              <div class="flex items-center gap-2">
                <i data-lucide="user-check" class="w-4 h-4 text-gray-500"></i>
                <span id="userTableRoleHeader"></span>
              </div>
            </th>
            <th scope="col" class="px-4 py-2 text-left">
              <div class="flex items-center gap-2">
                <i data-lucide="file-text" class="w-4 h-4 text-gray-500"></i>
                <span id="userTablePromptHeader"></span>
              </div>
            </th>
            <th scope="col" class="px-4 py-2 text-left">
              <div class="flex items-center gap-2">
                <i data-lucide="rocket" class="w-4 h-4 text-gray-500"></i>
                <span id="userTableLeadsHeader"></span>
              </div>
            </th>
            <th scope="col" class="px-4 py-2 text-left">
              <div class="flex items-center gap-2">
                <i data-lucide="clock" class="w-4 h-4 text-gray-500"></i>
                <span id="userTableLastAccessHeader"></span>
              </div>
            </th>
            <th scope="col" class="px-4 py-2 text-right">
              <div class="flex items-center gap-2 justify-end">
                <i data-lucide="settings" class="w-4 h-4 text-gray-500"></i>
                <span id="userTableActionsHeader"></span>
              </div>
            </th>
          </tr>
        </thead>
        <tbody id="userAccessTableBody" class="bg-white divide-y divide-gray-100"></tbody>
      </table>
    </div>
  </div>

  <div class="card p-5 space-y-4">
    <h3 id="userInviteTitle" class="text-lg font-semibold text-gray-800"></h3>
    <form id="userInviteForm" class="flex flex-col sm:flex-row gap-3">
      <input id="userInviteEmail" type="email" class="flex-1 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black/70" placeholder="" required>
      <div class="relative flex-1">
        <input id="userInvitePassword" type="password" class="w-full border border-gray-200 rounded-lg px-3 pr-10 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black/70" placeholder="" required>
        <button id="userInvitePasswordToggle" type="button" class="absolute inset-y-0 right-3 flex items-center text-gray-400 hover:text-gray-600 focus:outline-none" aria-pressed="false">
          <i data-lucide="eye" class="w-4 h-4"></i>
          <span class="sr-only">Mostrar clave</span>
        </button>
      </div>
      <button id="userInviteSubmit" type="submit" class="inline-flex items-center justify-center px-4 py-2 rounded-lg bg-black text-white text-sm disabled:opacity-60 disabled:cursor-not-allowed">
        <span id="userInviteButtonLabel"></span>
      </button>
    </form>
    <p id="userInviteFeedback" class="text-sm text-gray-500 hidden"></p>
  </div>
</section>


</div>
        </div>
      </main>

    </div>
  </div>

  <!-- Toast -->
<div id="toast"
  class="fixed top-[70px] left-1/2 -translate-x-1/2 bg-green-600 text-white px-4 py-2 rounded-lg opacity-0 text-sm shadow-lg transition-opacity z-[9999]">
</div>

<!-- 🧩 Modal de recorte de Header -->
<div id="cropperModal"
  class="fixed inset-0 bg-black/70 hidden items-center justify-center z-[9998]">
  <div class="bg-white rounded-2xl p-6 shadow-xl max-w-sm w-full text-center">
    <h3 class="font-semibold mb-4">Crop Header Image</h3>
    <div class="w-full aspect-square bg-gray-100 rounded-lg overflow-hidden flex items-center justify-center">
      <img id="cropperImage" class="max-w-full max-h-[300px]" />
    </div>

    <!-- Progress -->
    <div id="logoProgressWrap" class="mt-4 hidden w-full bg-gray-200 rounded-full overflow-hidden h-2">
      <div id="logoBar" class="h-2 w-0 bg-black transition-all duration-200"></div>
    </div>

    <div class="flex justify-center gap-3 mt-5">
      <button id="cancelCrop"
        class="px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-100">
        Cancel
      </button>
      <button id="confirmCrop"
        class="px-4 py-2 rounded-lg bg-black text-white hover:bg-gray-800">
        Save
      </button>
    </div>
  </div>
</div>



<!-- Modal: New bot -->
<div id="newBotModal" class="fixed inset-0 hidden items-center justify-center bg-black/40 backdrop-blur-sm z-[1300] px-4">
  <div class="modal-panel w-full max-w-lg p-7 space-y-6" role="dialog" aria-modal="true" aria-labelledby="newBotModalTitle" aria-describedby="newBotModalDescription">
    <div class="modal-accent"></div>
    <button id="closeNewBotModal" class="absolute top-5 right-5 text-slate-400 hover:text-slate-600 transition" aria-label="Cerrar">
      <i data-lucide="x" class="w-5 h-5"></i>
    </button>
    <div class="modal-header space-y-4">
      <div class="flex items-center gap-3">
        <span class="modal-icon">
          <i data-lucide="bot" class="w-5 h-5"></i>
        </span>
        <div class="space-y-1">
          <h3 id="newBotModalTitle">Crear un nuevo bot</h3>
          <p id="newBotModalDescription" class="text-sm">Elige si quieres empezar desde cero o duplicar el bot actual antes de nombrarlo.</p>
        </div>
      </div>
     
    </div>
    <div class="modal-options">
      <label class="modal-option-card" data-mode-card="new">
        <input class="modal-option-radio" type="radio" name="newBotMode" value="new" checked>
        <span class="modal-option-icon">
          <i data-lucide="sparkles" class="w-5 h-5"></i>
        </span>
        <div class="modal-option-content">
          <span class="modal-option-title">Crear desde cero</span>
          <span class="modal-option-description">Genera un bot vacío con la configuración básica para empezar rápidamente.</span>
        </div>
      </label>
      <label class="modal-option-card" data-mode-card="duplicate">
        <input class="modal-option-radio" type="radio" name="newBotMode" value="duplicate">
        <span class="modal-option-icon">
          <i data-lucide="copy" class="w-5 h-5"></i>
        </span>
        <div class="modal-option-content">
          <span class="modal-option-title">Duplicar bot actual</span>
          <span class="modal-option-description">Copia el contenido del bot activo y continúa personalizándolo.</span>
        </div>
      </label>
    </div>

    <div class="relative z-[1] space-y-1">
      <label for="newBotNameInput" class="text-xs font-semibold text-slate-500 uppercase tracking-[0.12em]">Nombre del bot</label>
      <input id="newBotNameInput" type="text" class="modal-input w-full px-4 py-2.5 text-sm focus:outline-none" placeholder="Ej. Bot conserjería" autocomplete="off" />
    </div>
    <p id="newBotError" class="modal-error hidden"></p>
    <div class="modal-actions flex items-center justify-end gap-3 pt-1">
      <button id="cancelNewBot" class="modal-secondary px-4 py-2.5 text-sm">Cancelar</button>
      <button id="confirmNewBot" class="modal-primary px-4 py-2.5 text-sm flex items-center gap-2">
        <i data-lucide="plus" class="w-4 h-4"></i>
        Create
      </button>
    </div>
  </div>
</div>

<!-- Modal: Delete bot -->
<div id="dashboardDeleteModal" class="fixed inset-0 hidden items-center justify-center bg-black/40 backdrop-blur-sm z-[1250] px-4">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 space-y-5 relative">
    <button id="closeDashboardDeleteModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600" aria-label="Cerrar">
      <i data-lucide="x" class="w-5 h-5"></i>
    </button>
    <div class="flex items-center gap-3">
      <span class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-red-100 text-red-600">
        <i data-lucide="shield-alert" class="w-5 h-5"></i>
      </span>
      <div>
        <h3 class="text-lg font-semibold text-gray-900">Eliminar bot</h3>
        <p class="text-sm text-gray-500">Esta acción no se puede deshacer.</p>
      </div>
    </div>
    <p class="text-sm text-gray-600">
      ¿Seguro que deseas eliminar <span id="dashboardDeleteBotName" class="font-semibold text-gray-900"></span>? Perderás todo su historial y configuración.
    </p>
    <div class="flex flex-col sm:flex-row sm:justify-end gap-2 sm:gap-3 pt-2">
      <button id="cancelDashboardDelete" type="button" class="px-4 py-2 rounded-lg border border-gray-200 text-sm font-medium text-gray-700 hover:bg-gray-50">Cancelar</button>
      <button id="confirmDashboardDelete" type="button" class="px-4 py-2 rounded-lg bg-red-600 text-white text-sm font-semibold flex items-center justify-center gap-2 hover:bg-red-700">
        <i data-lucide="trash-2" class="w-4 h-4"></i>
        Eliminar
      </button>
    </div>
  </div>
</div>

<!-- Modal: Add knowledge page -->
<div id="knowledgeModal" class="fixed inset-0 hidden items-center justify-center bg-black/40 backdrop-blur-sm z-[1200] px-4">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-xl p-6 space-y-4 relative">
    <button id="closeKnowledgeModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
      <i data-lucide="x" class="w-5 h-5"></i>
    </button>
    <div class="space-y-1">
      <h3 class="text-lg font-semibold">Add Page Knowledge</h3>
      <p class="text-sm text-gray-500">Paste the URL of the page you want to import. We will crawl it and organize the information automatically.</p>
    </div>
    <div class="space-y-2">
      <label for="knowledgeUrlInput" class="text-xs font-medium text-gray-600 uppercase tracking-wide">Page URL</label>
      <input id="knowledgeUrlInput" type="url" placeholder="https://example.com/page" class="w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black" />
    </div>
    <p id="knowledgeModalError" class="text-sm text-red-600 hidden"></p>
    <p id="knowledgeModalStatus" class="text-sm text-gray-500 hidden"></p>
    <div class="flex items-center justify-end gap-2 pt-2">
      <button id="cancelKnowledgeModal" class="px-4 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50">Cancel</button>
      <button id="confirmAddKnowledge" class="px-4 py-2 bg-black text-white rounded-lg text-sm flex items-center gap-2">
        <span>Add</span>
      </button>
    </div>
  </div>
</div>

<!-- Modal: Chat templates -->
<div id="chatTemplateModal" class="fixed inset-0 hidden items-center justify-center bg-black/40 backdrop-blur-sm z-[1200] px-4">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl p-6 space-y-5 relative">
    <button id="closeChatTemplateModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
      <i data-lucide="x" class="w-5 h-5"></i>
    </button>
    <div class="space-y-1 pr-10">
      <h3 class="text-lg font-semibold text-gray-900">Plantillas del chat</h3>
      <p class="text-sm text-gray-500">Selecciona una plantilla para aplicar rápidamente una combinación de colores. Luego podrás personalizar los detalles.</p>
    </div>
    <div id="chatTemplatePanel" class="space-y-4">
      <div id="chatTemplateGrid" class="grid gap-2 md:grid-cols-2 lg:grid-cols-3"></div>
    </div>
  </div>
</div>

<!-- Modal: Delete knowledge page -->
<div id="knowledgeDeleteModal" class="fixed inset-0 hidden items-center justify-center bg-black/40 backdrop-blur-sm z-[1200] px-4">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 space-y-5 relative">
    <button id="closeKnowledgeDeleteModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
      <i data-lucide="x" class="w-5 h-5"></i>
    </button>
    <div class="flex items-start gap-3">
      <div class="flex h-10 w-10 items-center justify-center rounded-full bg-red-50 text-red-600">
        <i data-lucide="trash-2" class="w-5 h-5"></i>
      </div>
      <div class="space-y-2">
        <h3 class="text-lg font-semibold">Delete knowledge page</h3>
        <p class="text-sm text-gray-600">
          Are you sure you want to delete <span id="deleteKnowledgePageTitle" class="font-medium text-gray-900"></span>? This action
          cannot be undone.
        </p>
      </div>
    </div>
  <div class="flex items-center justify-end gap-2 pt-2">
      <button id="cancelDeleteKnowledge" class="px-4 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50">Cancel</button>
      <button id="confirmDeleteKnowledge" class="px-4 py-2 bg-red-600 text-white rounded-lg text-sm hover:bg-red-700">Delete</button>
    </div>
  </div>
</div>

<!-- Modal: Delete user -->
<div id="userDeleteModal" class="fixed inset-0 hidden items-center justify-center bg-black/40 backdrop-blur-sm z-[1300] px-4">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 space-y-5 relative">
    <button id="closeUserDeleteModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600" aria-label="Cerrar">
      <i data-lucide="x" class="w-5 h-5"></i>
    </button>
    <div class="flex items-center gap-3">
      <span class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-red-100 text-red-600">
        <i data-lucide="trash-2" class="w-5 h-5"></i>
      </span>
      <div>
        <h3 id="userDeleteTitle" class="text-lg font-semibold text-gray-900"></h3>
        <p id="userDeleteSubtitle" class="text-sm text-gray-500"></p>
      </div>
    </div>
    <div class="flex flex-col sm:flex-row sm:justify-end gap-2 sm:gap-3 pt-2">
      <button id="userDeleteCancel" type="button" class="px-4 py-2 rounded-lg border border-gray-200 text-sm font-medium text-gray-700 hover:bg-gray-50"></button>
      <button id="userDeleteConfirm" type="button" class="px-4 py-2 rounded-lg bg-red-600 text-white text-sm font-semibold flex items-center justify-center gap-2 hover:bg-red-700">
        <i data-lucide="trash-2" class="w-4 h-4"></i>
        <span></span>
      </button>
    </div>
  </div>
</div>

<!-- Modal: Change password -->
<div id="userPasswordModal" class="fixed inset-0 hidden items-center justify-center bg-black/40 backdrop-blur-sm z-[1300] px-4">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 space-y-5 relative">
    <button id="closeUserPasswordModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600" aria-label="Cerrar">
      <i data-lucide="x" class="w-5 h-5"></i>
    </button>
    <div class="space-y-1">
      <h3 id="userPasswordTitle" class="text-lg font-semibold text-gray-900"></h3>
      <p class="text-sm text-gray-500"></p>
    </div>
    <div class="space-y-2">
      <input id="userPasswordInput" type="password" class="w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black" />
      <p id="userPasswordError" class="text-sm text-red-600 hidden"></p>
    </div>
    <div class="flex items-center justify-end gap-2 pt-2">
      <button id="userPasswordSave" class="px-4 py-2 bg-black text-white rounded-lg text-sm flex items-center gap-2">
        <span></span>
      </button>
    </div>
  </div>
</div>


  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-database-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-storage-compat.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/cropperjs@1.6.1/dist/cropper.min.js" defer></script>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/lucide@0.292.0/dist/umd/lucide.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
<script src="translations.js?v=49" defer></script>
<script src="js/core/firebase.js" defer></script>
  <script src="js/core/auth.js" defer></script>
  <script src="js/ui/ui.js" defer></script>
  <script src="js/ui/sidebar.js" defer></script>
  <script src="js/panels/dashboard.js" defer></script>
  <script src="js/panels/chat.js" defer></script>
  <script src="js/panels/knowledge.js" defer></script>
  <script src="js/panels/respuestas.js" defer></script>
  <script src="js/panels/prompt.js" defer></script>
  <script src="js/panels/usuarios.js" defer></script>
  <script src="js/panels/leads.js" defer></script>





<!-- 🎯 Selector de icono del widget -->
<div id="widgetIconModal"
  class="fixed inset-0 bg-black/70 hidden items-center justify-center z-[9998]">
  <div class="bg-white rounded-2xl p-6 shadow-xl max-w-md w-full">
    <div class="flex items-center justify-between mb-4">
      <h3 class="font-semibold text-lg">Choose the widget icon</h3>
      <button type="button" id="closeWidgetIconModal"
        class="p-2 rounded-full hover:bg-gray-100 text-gray-500 transition">
        <i data-lucide="x" class="w-4 h-4"></i>
      </button>
    </div>
    <p class="text-sm text-gray-500 mb-4">Select one of the available icons for your widget.</p>
    <div class="grid grid-cols-3 gap-12">
      <button type="button" class="widget-icon-option" data-widget-icon="wids/1.svg">
        <div class="widget-icon-inline"></div>
      </button>
      <button type="button" class="widget-icon-option" data-widget-icon="wids/2.svg">
        <div class="widget-icon-inline"></div>
      </button>
      <button type="button" class="widget-icon-option" data-widget-icon="wids/3.svg">
        <div class="widget-icon-inline"></div>
      </button>
      <button type="button" class="widget-icon-option" data-widget-icon="wids/4.svg">
        <div class="widget-icon-inline"></div>
      </button>
      <button type="button" class="widget-icon-option" data-widget-icon="wids/5.svg">
        <div class="widget-icon-inline"></div>
      </button>
      <button type="button" class="widget-icon-option" data-widget-icon="wids/6.svg">
        <div class="widget-icon-inline"></div>
      </button>
            <button type="button" class="widget-icon-option" data-widget-icon="wids/7.svg">
        <div class="widget-icon-inline"></div>
      </button>
            <button type="button" class="widget-icon-option" data-widget-icon="wids/8.svg">
        <div class="widget-icon-inline"></div>
      </button>
            <button type="button" class="widget-icon-option" data-widget-icon="wids/9.svg">
        <div class="widget-icon-inline"></div>
      </button>
    </div>
  </div>
</div>


<!-- 🧑‍🎨 Avatar Crop Modal -->
<div id="cropperModalAvatar"
  class="fixed inset-0 bg-black/70 hidden items-center justify-center z-[9998]">
  <div class="bg-white rounded-2xl p-6 shadow-xl max-w-sm w-full text-center">
    <h3 class="font-semibold mb-4">Crop Avatar</h3>
    <div class="w-full aspect-square bg-gray-100 rounded-lg overflow-hidden flex items-center justify-center">
      <img id="cropperImageAvatar" class="max-w-full max-h-[300px]" />
    </div>

    <!-- Progress -->
    <div id="avatarProgressWrap" class="mt-4 hidden w-full bg-gray-200 rounded-full overflow-hidden h-2">
      <div id="avatarBar" class="h-2 w-0 bg-black transition-all duration-200"></div>
    </div>

    <div class="flex justify-center gap-3 mt-5">
      <button id="cancelCropAvatar"
        class="px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 text-sm">Cancel</button>
      <button id="confirmCropAvatar"
        class="px-4 py-2 rounded-lg bg-black text-white hover:bg-gray-800 text-sm">Save</button>
    </div>
  </div>
</div>


<script>function fixTitle() { if (document.title !== 'Tomos Bot') { document.title = 'Tomos Bot'; } } // Cuando la página carga window.addEventListener('load', fixTitle); // Cuando vuelves a la pestaña document.addEventListener('visibilitychange', fixTitle); window.addEventListener('focus', fixTitle); // Por si algún script lo cambia después de un rato setInterval(fixTitle, 2000);</script>

</body>

</html>